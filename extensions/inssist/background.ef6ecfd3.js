!function(){function e(e){Object.defineProperty(e,"__esModule",{value:!0})}function t(e,t,s){Object.defineProperty(e,t,{get:s,enumerable:!0})}var s=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequired439,n=s("6UyrO"),a=s("4pwCs"),o=s("nIfN7"),r=s("7Mfds"),i=s("hQmIV"),l=s("6DHKG"),u=s("7xzSo"),c=s("3cqbl"),d=s("2JplJ"),f=s("2lIMO"),g=s("lPVHz"),h=s("3YoTT"),p=s("4RYcH"),m=s("6zDjW"),w=s("Saatc"),v=s("qnXVN"),b=s("23BIq"),y=s("4PGYP"),S=s("6oOtY"),k=s("3HMDR"),T=s("4QezY"),I=s("3u4tO"),P=s("4ZA4S"),A=s("uqDnl"),C=s("6PPN4"),U=s("6ExGy"),x=s("7rAex"),O=s("1g0wW"),F=s("5ZuLE"),D=s("47HXs"),R=s("3wQfI"),_=s("5NrOn"),E=s("367Kq"),N=s("7dHHw"),B=s("5zaO9"),L=s("hUK5n"),q=s("dfuZm"),H=s("23fUW"),M=s("2zvjG"),$=s("5Y5vM"),j=s("3634O"),V=s("1X6VZ"),J=s("45NE2"),z=s("55LBZ"),G=s("7wJlz"),W=s("50MFB"),K=s("XcRe2"),Y=s("4EOpL"),Z=s("6FJnj"),X=s("6EJm9"),Q=s("4Aaim"),ee=s("lUxTC"),te=s("520kD"),se=s("1aIyT"),ne=s("5SoTn");({maxFakeId:2147483647,lastFakeId:0,fakeIdToCallback:{},init:function(){this._setupWorker("/js/hack-timer-worker.min.js")},_getFakeId:function(){do{this.lastFakeId===this.maxFakeId?this.lastFakeId=0:this.lastFakeId++}while(this.fakeIdToCallback.hasOwnProperty(this.lastFakeId));return this.lastFakeId},_setupWorker:function(e){const t={},s="hack-timer-worker:";let n;try{n=new Worker(e),window.setInterval=(e,s)=>{const a=this._getFakeId();return t[a]={callback:e,parameters:Array.prototype.slice.call(arguments,2)},n.postMessage({name:"setInterval",fakeId:a,time:s}),a},window.clearInterval=e=>{t.hasOwnProperty(e)&&(delete t[e],n.postMessage({name:"clearInterval",fakeId:e}))},window.setTimeout=(e,s)=>{const a=this._getFakeId();return t[a]={callback:e,parameters:Array.prototype.slice.call(arguments,2),isTimeout:!0},n.postMessage({name:"setTimeout",fakeId:a,time:s}),a},window.clearTimeout=e=>{t.hasOwnProperty(e)&&(delete t[e],n.postMessage({name:"clearTimeout",fakeId:e}))},n.onmessage=e=>{const n=e.data.fakeId;let a,o,r;if(t.hasOwnProperty(n)&&(a=t[n],r=a.callback,o=a.parameters,a.hasOwnProperty("isTimeout")&&a.isTimeout&&delete t[n]),"string"==typeof r)try{r=new Function(r)}catch(e){console.log(`${s} error parsing callback code string: `,error)}"function"==typeof r&&r.apply(window,o)},n.onerror=e=>{console.log(e)},console.log(`${s} initialisation succeeded`)}catch(e){console.log(`${s} initialisation failed`),console.log(e)}}}).init(),n(),a(),o(),r(),i(),l(),a(),u(),c(),d(),f(),g(),h();class ae{constructor(e){this.defaultDelay=e,this.queue=Promise.resolve(),this.totalTasks=0,this.cleanupIndex=-1}addTask(e,t){const s=this.totalTasks++;return new Promise(((n,a)=>{this.queue=this.queue.then((async()=>{if(s<=this.cleanupIndex)t?n(await t()):n();else try{n(await e())}catch(e){a(e)}})),this.defaultDelay&&this.addDelay(this.defaultDelay)}))}addDelay(e){const t=this.totalTasks++;return new Promise((s=>{this.queue=this.queue.then((async()=>{t<=this.cleanupIndex||await h().default(e),s()}))}))}enqueueTask(e,t){const s=this.totalTasks++;return this.queue=this.queue.then((async()=>{if(s<=this.cleanupIndex)t&&await t();else try{await e()}catch(e){}})),this.defaultDelay&&this.enqueueDelay(this.defaultDelay),this}enqueueDelay(e){const t=this.totalTasks++;return this.queue=this.queue.then((async()=>{t<=this.cleanupIndex||await h().default(e)})),this}cleanup(){this.cleanupIndex=this.totalTasks-1}}function oe(e){return"[object Object]"===Object.prototype.toString.call(e)}p(),m(),w(),v(),b(),y(),S(),k(),f(),T(),I(),P(),y(),i();var re="fb-api.fb-error",ie="fb-api.failed-to-fetch-lsd-code",le="fb-api.failed-to-fetch-state-code",ue="fb-api.auth-window-closed-by-user",ce="fb-api.no-connected-fb-page",de="fb-api.unknown",fe={isError:function(e,t=null){return e&&e[ge]&&(!t||e.code===t)},checkAuth:we((async function e(t=!0){let s;try{P().fetcher.ignoreCache(),s=await P().fetcher.fetch("https://www.facebook.com/settings?tab=your_facebook_information")}catch(s){return t?e(!1):(i().sentryController.sendError("fbApi.checkAuth: failed","error",{details:s},{actor:"fb-api"}),!1)}if(s.redirected)return!1;return!0}),"check-auth"),logoutFcs:we((async function(){var e;P().fetcher.ignoreCache();const t=await P().fetcher.fetchText("https://business.facebook.com/creatorstudio"),s=(null===(e=t.match(/"logoutToken":"([^"]*)"/))||void 0===e?void 0:e[1])||null;s&&(P().fetcher.ignoreCache(),await P().fetcher.fetch(`https://business.facebook.com/logout.php?h=${s}`))}),"logout-fcs"),connectToFcs:we((async function(){var e,t;P().fetcher.ignoreCache();const s="https://business.facebook.com/creatorstudio",n=await P().fetcher.fetchText(s),a=await pe(n),o=/"LSD"[^"]*"token":"([^"]*)"/;let r=n;o.test(r)||(P().fetcher.ignoreCache(),r=await P().fetcher.fetchText(s));const i=(null===(e=r.match(o))||void 0===e?void 0:e[1])||null;if(!i)throw he({code:ie,html:r});const l=await me({url:"https://business.facebook.com/business_user/oauth/state/?type=3",body:{lsd:i}}),u=null==l||null===(t=l.payload)||void 0===t?void 0:t.state;if(!u)throw he({code:le,lsdCode:i,stateResponse:l});const c=await y().chromeBus.send("fb-api.auth-fcs",{appId:a,stateCode:u});if(!c)throw he({code:ue});await me({url:"https://business.facebook.com/media_manager/instagram/oauthlink/update/",body:{code:c}})}),"connect-to-fcs"),connectToFcsWithCrossposting:we((async function(){var e,t;P().fetcher.ignoreCache();const s=await P().fetcher.fetchText("https://business.facebook.com/creatorstudio"),n=await pe(s,{withCrossposting:!0}),a=await me({url:"https://business.facebook.com/media_manager/instagram/oauth_state/",incognito:!0}),o=null==a||null===(e=a.payload)||void 0===e?void 0:e.state;if(!o)throw he({code:le,stateResponse:a});const r=await y().chromeBus.send("fb-api.auth-fcs",{appId:n,stateCode:o,withCrossposting:!0});if(!r)throw he({code:ue});const i=await me({url:"https://business.facebook.com/media_manager/instagram/oauthlink/update/",body:{code:r}});if(!(null==i||null===(t=i.payload)||void 0===t?void 0:t.adminedPageID))throw he({code:ce})}),"connect-to-fcs-with-crossposting"),fcsDeletePost:we((async function(e){await me({url:f().default("https://business.facebook.com/media/manager/instagram_media/delete/",{id:e})})}),"fcs-delete-post"),fcsSaveAsDraft:we((async function(e){await me({url:f().default("https://business.facebook.com/media/manager/instagram_media/edit/save/",{"edit_data[media_id]":e,"edit_data[save_as_draft]":!0,"edit_data[source_product_name]":"MEDIA_MANAGER"})})}),"fcs-save-as-draft"),fcsSaveAsScheduled:we((async function(e,t){await me({url:f().default("https://business.facebook.com/media/manager/instagram_media/edit/save/",{"edit_data[media_id]":e,"edit_data[save_as_scheduled]":!0,"edit_data[scheduled_publish_time]":Math.round(t/1e3),"edit_data[source_product_name]":"MEDIA_MANAGER"})})}),"fcs-save-as-scheduled")};const ge=Symbol("isFbApiError");function he(e={}){return{...e,[ge]:!0}}async function pe(e,{withCrossposting:t=!1}={}){let s;const n=e.split('<link rel="preload" href="').map((e=>e.split('"')[0])).filter((e=>e.includes(".js")));for(const e of n){const n=await P().fetcher.fetchText(e,{credentials:"omit"}),a=t?n.match(/authenticateUser.*app_id:(\d+),response_type:"code"/):n.match(/app_id:(\d+),response_type:"code"/);if(s=null==a?void 0:a[1],s)break}return s||(i().sentryController.sendError("fbApi.connectToFcs: failed to fetch app id for fcs connection","error",{},{actor:"fb-api"}),s=t?"2216244465360995":"532380490911317"),s}async function me({url:e,incognito:t=!1,body:s={}}){var n;P().fetcher.ignoreCache();const a=(null===(n=(await P().fetcher.fetchText("https://business.facebook.com/creatorstudio")).match(/"DTSGInitialData"[^"]*"token":"([^"]*)"/))||void 0===n?void 0:n[1])||null,o=(await P().fetcher.fetchText(e,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:T().default({__a:1,locale:"en_US",...a&&{fb_dtsg:a},...s})})).replace("for (;;);","")||"{}",r=JSON.parse(I().default(o)),i=r.payload||{};if(Array.isArray(i.error)&&i.error.length||oe(i.error)&&Object.keys(i.error).length||i.error_code||i.errorCode||i.errorMessage)throw he({code:re,payload:i});return r}function we(e,t){const s=async(...s)=>{try{return await e(...s)}catch(e){if(e&&e[ge])throw e.method=t,e;throw i().sentryController.sendError(`fb-api.${t}`,"error",{details:e},{actor:"fb-api"}),he({code:de,method:t,details:e})}};return y().chromeBus.on(`fb-api.${t}`,(async(...e)=>{let t,n;try{t=await s(...e)}catch(e){n=e}return{result:t,error:n}})),s}A(),C(),U(),w(),x(),w(),A();const ve={init:function({parent:e}){this.parent=e,A().model.observe((e=>e.authStatus?e.authStatus.username:null),(()=>{this.updatePromocode()}),!1)},updatePro:async function(){await new Promise((e=>this.updatePromocode(e)))},updatePromocode:function(e){log("billing: updating promocode...");const{username:t,userId:s}=A().model.state.authStatus;if(t){const n={username:t,userId:s};if(w().env.options.collectBillingStats){const{followersCount:e,followingsCount:t,postsCount:a}=A().model.state.userDetails[s]||{};"number"==typeof e&&(n.followers=e),"number"==typeof t&&(n.followings=t),"number"==typeof a&&(n.posts=a)}this.parent.apiSender.send("/promo",{query:n}).then((t=>{if(!t||"ok"!==t.status)throw t;log(`  received promocode: ${JSON.stringify(t)}`);const s=t&&t.expiresAt;A().model.state.billing.promocode!==s&&A().transaction((e=>{e.billing.promocode=s})),this.parent.reply(e,s)})).catch((t=>{log(`  retrieving promocode failed: ${JSON.stringify(t)}`),this.parent.reply(e,A().model.state.billing.promocode)}))}else log("  no username to retrieve promocode for"),this.parent.reply(e,A().model.state.billing.promocode);return!!e}};a(),w(),A();const be={init:function({parent:e}){this.parent=e,A().model.observe((e=>e.billing.trial),(e=>{this.updateCookie(e)}),!1)},updatePro:async function(){await new Promise((e=>this.updateTrial(e)))},updateTrial:async function(e){log("billing: updating trial period...");const t=A().model.state.billing.trial,s=await this._getCookie({name:"tsd"});if(this._isCookieEmpty(s))return void this.parent.reply(e,t);const n=this._mergeTrialValues(t,s);n.installedOn||(n.installedOn=Date.now()),a().default.isEqual(t,n)||A().transaction((e=>{e.billing.trial=n})),a().default.isEqual(s,n)||this._setCookie({name:"tsd",value:n}),this.parent.reply(e,n)},updateCookie:async function(e){const t=await this._getCookie({name:"tsd"});this._isCookieEmpty(t)||(e=this._mergeTrialValues(t,e)),a().default.isEqual(t,e)||this._setCookie({name:"tsd",value:e})},_isCookieEmpty:function(e){return!e||1===Object.keys(e).length},_mergeTrialValues:function(e,t){const s={...e,...t};s.installedOn>e.installedOn&&(s.installedOn=e.installedOn);for(const t in s)(e[t]||0)>(s[t]||0)&&(s[t]=e[t]||0);return s},_getCookie:async function({name:e}){return new Promise((t=>{chrome.cookies.getAll({url:`https://${w().env.options.domain}`},(s=>{let n=(s||[]).filter((t=>t.name===e))[0]||{value:""};n=n.value;try{n=atob(n)}catch(e){}try{n=JSON.parse(n)}catch(e){n=null}t(n)}))}))},_setCookie:async function({name:e,value:t}){const s=Math.round(Date.now()/1e3),n=s+31536e4>2147483647?s+31536e4:2147483647;return new Promise((s=>{chrome.cookies.set({name:e||"cookie",value:btoa(JSON.stringify(t)),url:`https://${w().env.options.domain}`,path:"/",httpOnly:!1,secure:!1,storeId:"0",domain:w().env.options.domain,sameSite:"strict",expirationDate:n},s)}))}};A(),i();const ye={init:function({parent:e}){this.parent=e,chrome.runtime.onMessage.addListener(((e,t,s)=>"fspring.subscription-success"===e.name?this.onFSpringSubscriptionSuccess(e,s):"fspring.subscription-failure"===e.name?this.onFSpringSubscriptionFailure(e,s):void 0)),chrome.runtime.onMessage.addListener(((e,t,s)=>"update-fspring-status"===e.name&&this.updateFSpringStatus(s))),A().model.observe((e=>e.authStatus?e.authStatus.username:null),(()=>{this.recordUsernames()}),!0),A().model.observe((e=>e.billing&&e.billing.account?e.billing.account.token:null),(()=>{this.recordUsernames()}),!1),A().model.observe((e=>e.billing&&e.billing.account?e.billing.account.token:null),(()=>{this.updateFSpringStatus()}),!1)},recordUsernames:function(){const{billing:e,authStatus:t}=A().model.state,s=t.username;if(!s)return;const n=e.account?e.account.token:null;if(!n)return;if(-1!==e.recordedUsernames.indexOf(s))return;log("billing: updating associated fspring account usernames...");const a={usernames:[s]};this.parent.apiSender.send("/auth/record-usernames",{body:a,token:n}).then((()=>{A().transaction((e=>{e.billing.recordedUsernames=[...e.billing.recordedUsernames,s]}))})).catch((()=>{}))},updatePro:async function(){return new Promise((e=>this.updateFSpringStatus(e)))},updateFSpringStatus:function(e){log("billing: updating fspring status...");const{billing:t}=A().model.state,s=t.account?t.account.token:null;if(s){const t="/fspring/data";this.parent.apiSender.send(t,{token:s}).then((t=>{if(!t||"ok"!==t.status)throw t;A().transaction((e=>{e.billing.subscriptions=t.subscriptions||{},e.billing.products=t.products||{},e.billing.orders=t.orders||[]})),this.parent.reply(e,A().model.state.billing)})).catch((s=>{"TypeError"===s.name&&"Failed to fetch"===s.message||("forbidden"===s.status||"unauthorized"===s.status||"account-not-found"===s.status||"account-is-not-active"===s.status?A().transaction((e=>{e.billing.account.email=null,e.billing.account.token=null})):i().sentryController.sendError(`Unexpected API error at ${t}`,"error",{error:s},{actor:"auth"})),this.parent.reply(e,A().model.state.billing)}))}else A().transaction((e=>{e.billing.optimistic=null,e.billing.subscriptions={},e.billing.products={},e.billing.orders=[]})),this.parent.reply(e,A().model.state.billing);return!!e},onFSpringSubscriptionSuccess:function(e,t){log("billing: handling fspring subscription success..."),A().transaction((e=>{e.billing.optimistic={on:Date.now(),plan:e.billing.purchasingPlan.id},e.billing.purchasingPlan=null}));const s=JSON.stringify({subscriptions:A().model.state.billing.subscriptions,products:A().model.state.billing.products,orders:A().model.state.billing.orders}),n=Date.now();let a=3e3;const o=()=>{log("billing: polling server for status update..."),A().model.state.billing.optimistic&&this.updateFSpringStatus((e=>{const t=Date.now();t-n>36e5?A().transaction((e=>{e.billing.optimistic=null})):(e=JSON.stringify({subscriptions:e.subscriptions,products:e.products,orders:e.orders}),s===e?(a=t-n>3e4?6e5:3e3,setTimeout(o,a)):A().transaction((e=>{e.billing.optimistic=null})))}))};return setTimeout(o,a),!!t},onFSpringSubscriptionFailure:function(e,t){return log("billing: handling fspring subscription failure..."),A().transaction((e=>{e.billing.purchasingPlan=null})),!!t}},Se={init:function(){this.apiSender=new(x().Sender)({urlPrefix:w().env.options.apiUrl}),ve.init({parent:this}),be.init({parent:this}),ye.init({parent:this});return chrome.alarms.create("update-pro",{delayInMinutes:1440,periodInMinutes:1440}),chrome.alarms.onAlarm.addListener((e=>{"update-pro"===e.name&&this.updatePro()})),chrome.runtime.onMessage.addListener(((e,t,s)=>"update-pro"===e.name&&this.updatePro())),this},updatePro:async function(){await Promise.all([ve.updatePro(),be.updatePro(),ye.updatePro()])},reply:function(e,t){if(e)try{e(t)}catch(e){}}};i(),a(),w(),C(),A(),x(),y(),c(),A(),O(),k(),P(),b(),y(),F(),m(),d(),A(),P(),D(),k(),b(),y(),i(),m(),R(),d(),_(),A(),P(),v(),k(),y(),C(),A(),y(),E();var ke={init:function(){y().chromeBus.on("cleanup.clean-up-state",(()=>{const e=Date.now();return Te(e),e}))},cleanUpState:Te};function Te(e){A().transaction((t=>{t.cleanupId=e,t.dm.badgeText="",t.dm.ghostModeFailed=!1,t.reels.creating=!1,t.igView.creationCardShown=!1,t.igView.fullscreenWidth=460,t.billing.purchasingPlan=null,t.tagAssist.shown=!1,t.tagAssist.query="",t.tagAssist.searching=!1,t.tagAssist.errorCode=null,t.tagAssist.selectedTabId="search",t.tagAssist.selectedGroupId="medium",t.tagAssist.igSelectedTags=[],t.tagAssist.fcsSelectedTags=[],t.tagAssist.sidebarSelectedTags=[],t.tagAssist.sidebarSelectedTagsAsText="",t.tagAssist.ladderEngagementSort=null,t.tagAssist.summaryEngagementSort="descending",t.tagAssist.ladderPostCountSort=null,t.tagAssist.summaryPostCountSort=null,t.tagAssist.ladder=null,t.tagAssist.ladderLoadingTags=[],t.tagAssist.newCollection.name="",t.tagAssist.newCollection.text="",t.tagAssist.newCollection.showForm=!1,t.tagAssist.collectionsLoadingTags=[];for(const e of t.tagAssist.collections)e.editing=!1,e.editName="",e.editText="";const s=t.tagAssist.accountStats[t.authStatus.userId]||null,n=(null==s?void 0:s.mostUsedTags)||[];n.length>0&&(t.tagAssist.searching=!0,t.tagAssist.query=n.slice(0,2).map((e=>`#${e}`)).join(" ")),Object.assign(t.coverAssist,E().default),t.insights.filters.query="",t.insights.filters.posts="all",t.insights.filters.accounts="all",t.insights.loading=!1,t.analytics.filters.query="",t.analytics.filters.accounts="all",t.analytics.loading=!1,t.schedule.loading=!0,t.schedule.fcsError=null,t.schedule.fcsFailed=!1,t.schedule.isErrorShown=!1,t.schedule.isUpsellShown=!1,t.schedule.hasUncommitedChanges=!1,t.schedule.gridAddCardAttention=!1,t.schedule.showTagAssist=!1,t.schedule.tasks=[],t.schedule.bulkUploadErrors=[],t.schedule.posts=t.schedule.posts.filter((e=>"saving"!==e.saveStatus)).filter((e=>"deleting"!==e.saveStatus)),t.schedule.posts.forEach((e=>{e.preview=null})),t.schedule.fallback.isFailedToReconnect=!1,t.schedule.fallback.isRetryingFbConnection=!1,t.schedule.fallback.hideSwitchToFallbackButton=!1,t.schedule.navigation.isOpen=!1,t.schedule.navigation.selectedTabId=null,t.schedule.navigation.withBackToCalendarButton=!1,t.schedule.fcsSetup.checking=!0,t.schedule.fcsSetup.connected=!1,t.schedule.fcsSetup.connecting=!1,t.schedule.fcsSetup.showPanel=!1,t.schedule.fcsSetup.errorCode=null,t.schedule.calendar.periodStart=null,t.schedule.dateDialog=N().default(t)}))}B(),m(),y(),O();var Ie={init:async function(){return void await O().idbController.delete("image-proxy.cache");Ce=await O().idbController.get("image-proxy.cache")||{},Ae.resolve(),y().chromeBus.on("image-proxy.save",Ue),y().chromeBus.on("image-proxy.cache-item-used",xe)},save:Ue};const Pe=15*m().SECOND,Ae=B().default();let Ce;async function Ue(e){}async function xe(e){Ce[e]&&(Ce[e].lastUsedAt=Date.now(),Oe())}function Oe(){const e=Oe;clearTimeout(e.timeout),e.timeout=setTimeout((async()=>{O().idbController.set("image-proxy.cache",Ce)}),Pe)}L(),y();var Fe={getVersion:function(){if(void 0===De){const e=/Chrome\/([0-9.]+)/.exec(window.navigator.userAgent)[1];De=e?Number(e.split(".")[0]):-1}return De}};let De;var Re={init:function(){Ee=-1,y().chromeBus.on("core-web-request.popup-tab-id",(e=>{_e=e}))},watch:function(e,t){chrome.webRequest.onBeforeRequest.addListener((e=>{let s=null;const n=new URL(e.url).host;return t({details:e,isBeforeRequest:!0,isRequest:!1,isResponse:!1,fromExtension:Be(e),checkUrl:function(t){return e.url.includes(t)},checkHost:function(e){return n.includes(e)},redirect:function(e){s={redirectUrl:e}},getHeader:function(){},setHeader:function(){}}),s}),{urls:e},["blocking"]),chrome.webRequest.onBeforeSendHeaders.addListener((e=>{Ne(e.requestHeaders);const s=new URL(e.url).host;return t({details:e,isBeforeRequest:!1,isRequest:!0,isResponse:!1,fromExtension:Be(e),redirect:function(){},checkUrl:function(t){return e.url.includes(t)},checkHost:function(e){return s.includes(e)},getHeader:function(t){return t=t.toLowerCase(),e.requestHeaders.find((e=>e.name===t))},setHeader:function(t,s){t=t.toLowerCase(),e.requestHeaders=e.requestHeaders.filter((e=>e.name!==t)),e.requestHeaders.push({name:t,value:s})},removeHeader:function(t){t=t.toLowerCase(),e.requestHeaders=e.requestHeaders.filter((e=>e.name!==t))}}),{requestHeaders:e.requestHeaders}}),{urls:e},Fe.getVersion()<72?["blocking","requestHeaders"]:["blocking","requestHeaders","extraHeaders"]),chrome.webRequest.onHeadersReceived.addListener((e=>{Ne(e.responseHeaders);const s=new URL(e.url).host;return t({details:e,isBeforeRequest:!1,isRequest:!1,isResponse:!0,fromExtension:Be(e),redirect:function(){},checkUrl:function(t){return e.url.includes(t)},checkHost:function(e){return s.includes(e)},getHeader:function(t){return t=t.toLowerCase(),e.responseHeaders.find((e=>e.name===t))},setHeader:function(t,s){t=t.toLowerCase(),e.responseHeaders=e.responseHeaders.filter((e=>e.name!==t)),e.responseHeaders.push({name:t,value:s})},removeHeader:function(t){t=t.toLowerCase(),e.responseHeaders=e.responseHeaders.filter((e=>e.name!==t))}}),{responseHeaders:e.responseHeaders}}),{urls:e},Fe.getVersion()<72?["blocking","responseHeaders"]:["blocking","responseHeaders","extraHeaders"])}};let _e=null,Ee=null;function Ne(e){for(const t of e)t.name=t.name.toLowerCase()}function Be(e){return e.tabId===_e||e.tabId===Ee}const Le=L().default();var qe={init:function(){Re.watch(["https://*.onfastspring.com/*","https://*.instagram.com/*","https://*.facebook.com/*","https://*.inssist.com/*"],$e)},onRequest:Le};let He,Me;function $e({details:e,isBeforeRequest:t,isRequest:s,isResponse:n,fromExtension:a,redirect:o,getHeader:r,setHeader:i,removeHeader:l,checkUrl:u,checkHost:c}){var d,f,g;if(Le(arguments[0]),t&&c("app.inssist.com")&&o(chrome.runtime.getURL("/inssist.html")),t&&c("instagram.com")&&u("service-worker-")&&o(chrome.runtime.getURL("/js/ig-service-worker.js")),s&&a&&(c("instagram.com")||c("facebook.com")||c("fastspring.com"))){const t=r("origin");if(!t||(null==t?void 0:t.value.startsWith("chrome-extension"))){i("origin",new URL(e.url).origin)}}s&&c("instagram.com")&&u("/direct/inbox")&&(null===(d=e.initiator)||void 0===d?void 0:d.startsWith(`chrome-extension://${chrome.runtime.id}`))&&(He=e.frameId);const h=s&&c("instagram.com")&&"POST"===e.method&&(u("/accounts/login/ajax/")||u("/one_tap_web_login/")),p=s&&c("instagram.com")&&(a||u("/api/v1/"))&&!u("/tv/upload")&&e.tabId!==He;if(h||p){let e="Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1";u("/api/v1/")&&(e=`${e} Instagram 72.0.0.21.98`),i("user-agent",e)}if(n&&(c("instagram.com")||c("facebook.com")||c("inssist.com")||c("onfastspring.com"))&&(e.responseHeaders=e.responseHeaders.filter((e=>"x-frame-options"!==e.name))),n&&(c("instagram.com")||c("facebook.com")||c("inssist.com")||c("onfastspring.com"))&&(e.responseHeaders=e.responseHeaders.filter((e=>"content-security-policy"!==e.name&&"content-security-policy-report-only"!==e.name))),n&&c("facebook.com")&&(u("/confirmemail.php")||u("/home.php"))&&(null===(f=e.initiator)||void 0===f?void 0:f.includes("business.facebook.com"))&&(i("access-control-allow-origin","https://business.facebook.com"),i("access-control-allow-credentials","true")),n&&c("facebook.com")&&u("/home.php")&&(null===(g=e.initiator)||void 0===g?void 0:g.includes("web.facebook.com"))&&(i("access-control-allow-origin","https://web.facebook.com"),i("access-control-allow-credentials","true")),n&&c("instagram.com")&&i("access-control-expose-headers","*, Authorization"),n&&c("instagram.com")){const e=r("x-ig-set-www-claim");e&&Me!==e.value&&(Me=e.value)}if(s&&c("instagram.com")){const e=r("x-ig-www-claim");e&&"auto"===e.value&&(Me?i("x-ig-www-claim",Me):l("x-ig-www-claim"))}}var je={init:async function(){await async function(){if("username"in A().model.state.authStatus)return;P().fetcher.ignoreCache();const e=await k().igApi.fetchViewerInfo();if(e.error)return;const t=e.result||null;A().transaction((e=>{e.authStatus.userId=(null==t?void 0:t.userId)||null,e.authStatus.username=(null==t?void 0:t.username)||null,e.authStatus.fullName=(null==t?void 0:t.fullName)||null,e.authStatus.email=(null==t?void 0:t.email)||null,e.authStatus.avatarUrl=(null==t?void 0:t.avatarUrl)||null,e.authStatus.isLoggedIn=!!t,e.authStatus.isMobileSession=(null==t?void 0:t.isMobileSession)||!1,e.authStatus.cookies=(null==t?void 0:t.cookies)||{igSessionId:null,fb:[]}})),await et()}(),function(){let e;chrome.cookies.onChanged.addListener((({cookie:t,removed:s})=>{Je||A().model.state.schedule.fcsSetup.connecting||".instagram.com"===t.domain&&"sessionid"===t.name&&(clearTimeout(e),e=setTimeout((()=>{Ge({isSettingSessionId:!s})})))}))}(),function(){let e;qe.onRequest((({details:s,isResponse:n,checkHost:a})=>{if(n&&a("facebook.com")){!!s.responseHeaders.find((e=>"set-cookie"===e.name))&&(clearTimeout(e),e=setTimeout(t))}}));const t=async()=>{const e=await d().default(chrome.cookies.getAll,{domain:".facebook.com"});A().transaction((t=>{t.authStatus.cookies.fb=e}))}}(),y().chromeBus.on("auth.set-ig-initial-url",We),y().chromeBus.on("auth.login",Ke),y().chromeBus.on("auth.logout",Ye),y().chromeBus.on("auth.refresh-user",Ge),y().chromeBus.on("auth.toggle-session-watcher",Qe),chrome.runtime.onMessage.addListener(((e,t,s)=>"update-user"===e.name&&ze()))},updateUser:ze,refreshUser:Ge,clearFbCookies:Ze};let Ve=null,Je=!1;async function ze(e=!1){log("auth-controller: updating user id...");!await Ge()&&e&&chrome.tabs.update({url:v().ig.login.url})}async function Ge({isSettingSessionId:e=!1}={}){const t=Ge,s=R().generate();t.requestId=s,P().fetcher.ignoreCache();const n=await k().igApi.fetchViewerInfo();if(t.requestId!==s)return;if(n.error)return;const a=n.result||null,o=a&&A().model.state.authStatus.userId===a.userId;return a&&Ie.save(a.avatarUrl),A().transaction((t=>{if(a&&t.authStatus.userId===a.userId)return t.authStatus.username=a.username,t.authStatus.avatarUrl=a.avatarUrl,t.multiaccount.selectedUserId=a.userId,void(e&&(t.authStatus.isMobileSession=!0));if(a){const e=t.multiaccount.userIds;t.multiaccount.addingNewAccount?t.multiaccount.addingNewAccount=!1:t.authStatus.isLoggedIn||_().default(e,t.multiaccount.selectedUserId),e.includes(a.userId)||e.push(a.userId),t.multiaccount.selectedUserId=a.userId}if(t.authStatus.userId){t.userStates[t.authStatus.userId]={};const e=C().getTemplateUserState();for(const s in e)t.userStates[t.authStatus.userId][s]=t[s];t.userStates[t.authStatus.userId].authStatus.isMobileSession=!1}let s=null;a&&t.userStates[a.userId]?(s=t.userStates[a.userId],delete t.userStates[a.userId]):s=C().getTemplateUserState(),s.authStatus.userId=(null==a?void 0:a.userId)||null,s.authStatus.username=(null==a?void 0:a.username)||null,s.authStatus.avatarUrl=(null==a?void 0:a.avatarUrl)||null,s.authStatus.isLoggedIn=!!a,e&&(s.authStatus.isMobileSession=!0),Object.assign(t,s)})),await et(),o||(y().chromeBus.send("iframe-bus","ig.clear-and-show-spinner"),a?Ve?y().chromeBus.send("iframe-bus","ig.hard-go",Ve):(ke.cleanUpState(),y().chromeBus.send("iframe-bus","ig.refresh")):y().chromeBus.send("iframe-bus","ig.hard-go","/accounts/login/"),y().chromeBus.send("iframe-bus","dm.refresh"),y().chromeBus.send("iframe-bus","schedule.fcs-refresh-page")),Ve=null,y().chromeBus.send("auth.refreshed"),a}function We(e){Ve=e}async function Ke(e){var t;const s=null===(t=A().model.state.userStates[e])||void 0===t?void 0:t.authStatus;if(s){Qe(!1);try{await Ze();for(const e of s.cookies.fb)await d().default(chrome.cookies.set,{url:"https://*.facebook.com",name:e.name,value:e.value,domain:e.domain,path:e.path,secure:e.secure,httpOnly:e.httpOnly,sameSite:e.sameSite,storeId:e.storeId,expirationDate:e.expirationDate});await Xe(),await d().default(chrome.cookies.set,{url:"https://*.instagram.com",name:"sessionid",value:s.cookies.igSessionId,domain:".instagram.com",path:"/",secure:!0,httpOnly:!1,sameSite:"no_restriction",expirationDate:Math.round((Date.now()+365*m().DAY)/1e3)})}catch(e){console.error(e)}Qe(!0),setTimeout((()=>{Ge({isSettingSessionId:!1})}))}else console.error("auth status not found",{userId:e})}async function Ye(){await Ze(),await Xe()}async function Ze(){const e=await d().default(chrome.cookies.getAll,{domain:".facebook.com"});for(const t of e)await d().default(chrome.cookies.remove,{url:"https://*.facebook.com",name:t.name})}async function Xe(){await d().default(chrome.cookies.remove,{url:"https://*.instagram.com/*",name:"sessionid"})}function Qe(e){Je=!e}async function et(){const e=await d().default(chrome.cookies.get,{url:"https://*.instagram.com",name:"sessionid"}),t=await d().default(chrome.cookies.getAll,{domain:".facebook.com"});A().transaction((s=>{s.authStatus.cookies.igSessionId=(null==e?void 0:e.value)||null,s.authStatus.cookies.fb=t}))}q();var tt={init:function(){y().chromeBus.on("schedule.connect-to-fcs",st),y().chromeBus.on("schedule.connect-to-fcs-with-crossposting",nt)}};async function st(){var e;A().transaction((e=>{e.schedule.fcsSetup.connecting=!0})),await je.clearFbCookies(),P().fetcher.ignoreCache();const t=(null===(e=(await P().fetcher.fetchText("https://business.facebook.com/creatorstudio")).match(/js_datr","([^"]*)"/))||void 0===e?void 0:e[1])||null;await d().default(chrome.cookies.set,{url:"https://*.facebook.com",name:"datr",value:t,domain:".facebook.com",path:"/",secure:!0,httpOnly:!0,sameSite:"no_restriction",storeId:"0",expirationDate:Math.round((Date.now()+365*m().DAY)/1e3)}),P().fetcher.ignoreCache();const s=(await k().igApi.fetchViewerInfo()).result;if(s||A().transaction((e=>{e.schedule.fcsSetup.connecting=!1,e.schedule.fcsSetup.errorCode=q().default.failedToFetchViewerInfo})),s.isProfessionalAccount){try{await fe.connectToFcs()}catch(e){if(A().transaction((e=>{e.schedule.fcsSetup.connecting=!1})),fe.isError(e,ue))return void je.refreshUser();let t;return t=fe.isError(e)?e.code:q().default.unknown,A().transaction((e=>{e.schedule.fcsSetup.errorCode=t})),i().sentryController.sendError(`schedule setup: ${t}`,"error",e,{actor:"schedule"}),void D().gaController.sendEvent("user","schedule:setup-connection-error",t)}A().transaction((e=>{e.schedule.fcsSetup.connecting=!1,e.schedule.fcsSetup.showPanel=!1,e.schedule.loading=!0})),await je.refreshUser(),y().chromeBus.send("iframe-bus","schedule.fcs-refresh-page"),D().gaController.sendEvent("user","schedule:setup-connection-success")}else A().transaction((e=>{e.schedule.fcsSetup.connecting=!1,e.schedule.fcsSetup.errorCode=q().default.nonProfessionalAccount}))}async function nt(){A().transaction((e=>{e.schedule.fcsSetup.connecting=!0}));const e=await fe.checkAuth();if(e){e&&await fe.logoutFcs();try{await fe.connectToFcsWithCrossposting()}catch(e){if(A().transaction((e=>{e.schedule.navigation.isOpen=!1,e.schedule.fcsSetup.connecting=!1})),fe.isError(e,ue))return void je.refreshUser();let t;return fe.isError(e,ce)?(t=q().default.noConnectedFbPage,y().chromeBus.send("iframe-bus","schedule.fcs-refresh-page")):t=fe.isError(e)?e.code:q().default.unknown,A().transaction((e=>{e.schedule.fcsSetup.showPanel=!0,e.schedule.fcsSetup.errorCode=t})),i().sentryController.sendError(`schedule crossposting setup: ${t}`,"error",e,{actor:"schedule"}),A().transaction((e=>{e.schedule.loading=!0})),b().eventBus.send("schedule.update-ig-posts"),void D().gaController.sendEvent("user","schedule:setup-crossposting-error",t)}A().transaction((e=>{e.schedule.navigation.isOpen=!1,e.schedule.navigation.selectedTabId=null,e.schedule.fcsSetup.connecting=!1,e.schedule.fcsSetup.showPanel=!1,e.schedule.loading=!0})),await je.refreshUser(),y().chromeBus.send("iframe-bus","schedule.fcs-refresh-page"),D().gaController.sendEvent("user","schedule:setup-crossposting-success")}else A().transaction((e=>{e.schedule.navigation.isOpen=!1,e.schedule.fcsSetup.connecting=!1,e.schedule.fcsSetup.showPanel=!0,e.schedule.fcsSetup.errorCode=q().default.fbLoginRequired}))}c(),P(),O(),A(),y(),H(),M();var at={init:function(){!function(){const e={};let t=!1,s=!1;async function n(){if(t)return void(s=!0);t=!0;const a={};let o=0;for(const t of H().default.getPosts()){const n=A().model.state,r=t.id,i=n.schedule.posts.find((e=>e.id===r));if("fcs"!==i.source)continue;if(e[i.id])continue;if(o+=1,o>9){s=!0;continue}const l=`schedule.fcs-post-preview:${i.id}`,u=await c().default((()=>O().idbController.get(l)));if(u){e[i.id]=URL.createObjectURL(u);continue}let d;try{const e=await P().fetcher.fetch(i.image,{credentials:"omit"}),t=await e.blob();d=await M().default(t)}catch(e){console.error(e);continue}await c().default((()=>O().idbController.set(l,d.blob))),a[i.id]=d.averageColor,e[i.id]=URL.createObjectURL(d.blob)}A().transaction((t=>{const s=t.schedule.posts.filter((e=>"fcs"===e.source));for(const t of s)t.preview=e[t.id];for(const e in a){const t=s.find((t=>t.id===e));t&&(t.imageAvgColor=a[e])}})),t=!1,s&&(s=!1,n())}A().model.observe((e=>H().default.getPosts().filter((e=>"fcs"===e.source)).map((e=>e.id)).join("-")),n),y().chromeBus.on("popup.start",(()=>{for(const t in e)URL.revokeObjectURL(e[t]),delete e[t];n()}))}()}};m(),y(),i();var ot={init:function(){!function(){let e;y().chromeBus.on("schedule.upload-99",(t=>{clearTimeout(e),e=setTimeout((()=>{i().sentryController.sendError("Upload stuck at 99.9%","error",{debugData:t},{actor:"schedule"})}),20*m().SECOND)})),y().chromeBus.on("schedule.upload-100",(()=>{clearTimeout(e)}))}()}};var rt={init:function(){tt.init(),at.init(),ot.init(),async function(){y().chromeBus.on("popup.start",(async()=>{const e=[A().model.state,...Object.values(A().model.state.userStates)],t=e.map((e=>e.schedule.posts)).flat().filter((e=>"fcs"===e.source)).map((e=>e.id.toString())),s=e.map((e=>e.schedule.posts)).flat().filter((e=>"local"===e.source)).map((e=>e.id.toString())),n=await O().idbController.getAllKeys();for(const e of n)if(e.startsWith("schedule.fcs-post-preview:")){const s=e.split(":")[1];if(t.includes(s))continue;await c().default((()=>O().idbController.delete(e)))}else if(e.startsWith("schedule.local-post:")){const t=e.split(":")[1];if(s.includes(t))continue;await c().default((()=>O().idbController.delete(e)))}}))}(),y().chromeBus.on("schedule.update-ig-posts",it),b().eventBus.on("schedule.update-ig-posts",it)},getReport:async function(){return await y().chromeBus.send("iframe-bus","schedule.fcs-get-report")}};async function it(){const e=A().model.state,t=e.authStatus.username;if(!t)return;if(e.schedule.fcsSetup.checking)return;if(e.schedule.fcsSetup.connected)return;P().fetcher.ignoreCache();const s=await k().igApi.fetchUserPosts(t,50);if(e.authStatus.username!==t)return;const n=(s.result||[]).map((e=>{const t={photo:"photo",video:"video",carousel:"carousel"}[e.type];return t?F().default({id:e.id,source:"ig",type:t,status:"posted",image:e.imgMedium||e.img||e.imgx,preview:e.imgMedium||e.img||e.imgx,imageAvgColor:null,on:e.on,createdOn:e.on,stats:{likes:e.stats.likes,comments:e.stats.comments},crosspostToFb:null,saveStatus:null,draftOrder:null}):null})).filter(Boolean);A().transaction((e=>{e.schedule.loading=!1,e.schedule.lastIgPostsUpdateOn=Date.now(),e.schedule.posts=e.schedule.posts.filter((e=>"local"===e.source)).concat(n)}))}N();var lt={init:function(){y().chromeBus.on("overseer.send-report",dt)},sendReport:dt};const ut=["acknowledged","analytics","dm","experiments","followUs","igTask","igView","igtvUpload","insights","multiaccount","rateUs","sidebar","tagAssist","userDetails","welcome",{field:"authStatus",cb:e=>a().default.cloneDeep(e)},{field:"authStatus.cookies",cb:()=>"!sanitized"},{field:"billing",cb:e=>a().default.cloneDeep(e)},{field:"billing.account.token",cb:()=>"!sanitized"},{field:"schedule",cb:e=>{const t=a().default.cloneDeep(e);return t&&t.posts&&(t.posts=t.posts.map((e=>(delete e.image,delete e.preview,e)))),t}},{field:"userStates",cb:()=>"!ignored"},{field:"whatsNew",cb:()=>"!ignored"}],ct=new(x().Sender)({urlPrefix:w().env.options.apiUrl});async function dt({key:e,filters:t,data:s}={}){if(e=e||"system",s=s||{},(t=t||{}).username||(t.username=C().stateProxy.username()||"unknown"),"string"!=typeof s&&!s.state){const e=A().model.state,t={};ut.forEach((s=>{if("string"==typeof s)t[s]=e[s];else{const n=e[s.field];t[s.field]=s.cb(n)}})),s.state=t}"string"==typeof s||s.schedule||(s.schedule=await rt.getReport());try{s=JSON.stringify(s)}catch(e){s=e.message}const n={key:e,filters:t,data:s};w().env.is.development&&y().chromeBus.send("popup.log","%coverseer report [background]","color: #c818dc",{key:e,filters:t,data:JSON.parse(s)}),ct.send("/overseer",{body:n}).then((t=>{log(`overseer ${e} report of ${s.length} bytes was sent`)})).catch((t=>{error(`! failed sending ${e} overseer report of ${s.length} bytes:`),error(t)}))}R(),$(),j(),V(),h(),d(),g(),m(),v(),y(),C(),A(),P(),k(),y(),A(),C(),k(),v();const ft=new ae(v().sleepTimes.action);var gt={init:async function(){log("ig-task: initialisation succeeded"),y().chromeBus.on("ig-task.follow-user",pt),y().chromeBus.on("ig-task.unfollow-user",mt),y().chromeBus.on("ig-task.like-user",wt),A().model.observe((()=>C().stateProxy.userId()),(()=>ft.cleanup()),!1)},followUser:pt,unfollowUser:mt};const ht={};async function pt(e){if(!e)return!1;const{userId:t}=e;return ft.addTask((async()=>{const e=await k().igApi.followUser(t);return e.error?(vt(e.error),!1):(A().transaction((e=>{e.igTask.followStatus||(e.igTask.followStatus={}),e.igTask.followStatus[t]=!0})),!0)}))}async function mt(e){if(!e)return!1;const{userId:t}=e;return ft.addTask((async()=>{const e=await k().igApi.unfollowUser(t);return e.error?(vt(e.error),!1):(A().transaction((e=>{e.igTask.followStatus||(e.igTask.followStatus={}),e.igTask.followStatus[t]=!1})),!0)}))}async function wt(e){if(!e)return!1;const{userId:t,username:s}=e,n=C().stateProxy.userId(),a=()=>{A().transaction((e=>{const s=C().stateProxy.userId()===n?e:e.userStates[n];!s||s.igTask.likeStatus[t]<=0||(s.igTask.likeStatus[t]-=1)}))},o=A().model.state.igTask.likeStatus[t]||0;return!(o>=12)&&(A().transaction((e=>{e.igTask.likeStatus[t]=o+1})),ft.addTask((async()=>{let e=await k().igApi.fetchRootUserPostsPage(s);if(e.error)return a(),vt(e.error),!1;e=e.result;const t=e.posts.filter((e=>!e.isLiked&&!0!==ht[e.code]));if(0===t.length)return a(),!1;let n=null;if(e.posts[0]===t[0])n=e.posts[0];else{let e=0,s=null;t.forEach((t=>{const n=t.stats.likes+10*t.stats.comments;n>=e&&(s=t,e=n)})),n=s}return(await k().igApi.likePost(n.id)).error?(a(),vt(e.error),!1):(ht[n.code]=!0,!0)}),(()=>{a()})))}function vt(e){const{code:t}=e;t!==k().ec.noNetwork&&t!==k().ec.timedOut&&t!==k().ec.redirectToLogin&&t!==k().ec.suspended&&t!==k().ec.forbidden&&t!==k().ec.tooManyRequests&&t!==k().ec.serverIsDown&&t!==k().ec.badGateway&&t!==k().ec.serviceUnavailable||ft.cleanup(),A().transaction((e=>{e.igTask.actionBlockCode=t}))}v();const bt=new ae(v().sleepTimes.peers);J();var yt={init:async function(){y().chromeBus.on("analytics.check-now",St),y().chromeBus.on("analytics.stop",kt),A().transaction((e=>{e.analytics.runningJobId=null})),A().model.observe((()=>C().stateProxy.userId()),(async()=>{null!==A().model.state.analytics.runningJobId&&A().transaction((e=>{e.analytics.runningJobId=null})),await At(),Tt()}),!1),A().model.observe((e=>e.analytics.runAutomatically),(()=>{Tt()}),!1),A().model.observe((e=>`${e.analytics.scheduleDay}-${e.analytics.scheduleHour}`),(async()=>{await At(),Tt()}),!1),await At(),Tt()}};async function St(){try{await At(),await It(),Tt()}catch(e){A().transaction((t=>{t.analytics.runningJobId=null,t.analytics.error=e.message||e}))}}async function kt(){A().transaction((e=>{e.analytics.runningJobId=null,e.analytics.error="check has been interrupted"}))}async function Tt(){if(!A().model.state.analytics.runAutomatically)return await At(),void A().transaction((e=>{e.analytics.nextScanOn=null}));if(await d().default(chrome.alarms.get,"analytics.schedule"))return;let e;{const t=A().model.state,s=Date.now(),n=t.analytics.lastScanOn;if(-1===t.analytics.scheduleDay)e=V().default(s).getTime()+t.analytics.scheduleHour*m().HOUR,j().default(n,e)&&(e+=m().DAY);else{const a=$().default(s);let o=t.analytics.scheduleDay-a;o<0&&(o+=7),e=V().default(s).getTime()+o*m().DAY+t.analytics.scheduleHour*m().HOUR,j().default(n,e)&&(e+=m().WEEK)}e<s&&(e=s+m().MINUTE)}A().transaction((t=>{t.analytics.nextScanOn=e})),g().default("analytics.schedule",{when:e},(async()=>{try{await It()}catch(e){return void A().transaction((t=>{t.analytics.lastScanOn=Date.now(),t.analytics.runningJobId=null,t.analytics.error=e.message||e}))}await At(),Tt()}))}async function It({nosleep:e=!1}={}){if(null!==A().model.state.analytics.runningJobId)return;if(!A().model.state.authStatus.isLoggedIn)return;const t=R().generate();A().transaction((e=>{e.analytics.runningJobId=t,e.analytics.scanProgress=0}));const s=await J().default.getAnalytics(),n=Date.now(),a=C().stateProxy.username(),o=await async function(e){P().fetcher.ignoreCache();const t=await k().igApi.fetchUserDetails(e);if(!t.result){if(t.error.code===k().ec.tooManyRequests)return null;throw new Error(`could not fetch @${e} followers count`)}return t.result}(a),r=async(r,i=0)=>{let l,u,c,d,f;if("followers"===r)l=s.followers,u=o.followersCount,c=v().analytics.maxFollowersCount,d=k().igApi.fetchRootFollowersPage,f=k().igApi.fetchNextFollowersPage;else{if("followings"!==r)return console.error("invalid peers type"),null;l=s.followings,u=o.followingsCount,c=v().analytics.maxFollowingsCount,d=k().igApi.fetchRootFollowingsPage,f=k().igApi.fetchNextFollowingsPage}const g=new Set(l.map((e=>e.userId)));let p,m=!1,w=0;p=0===l.length?null:o?Math.min(u,c)-l.length:null;let b=[];const y=new Set,S=[],T=[];let I=null;const C=e=>bt.addTask((()=>(P().fetcher.ignoreCache(),e?f(e):d(a))));do{if(I&&!e&&(await h().default(v().sleepTimes.peers),Pt()!==t))return null;let s=await C(I);if(s.error&&s.error.code===k().ec.tooManyRequests&&await h().default({min:6e4,max:3e5}),s.result||(s=await C(I)),Pt()!==t)return null;if(!s.result)throw new Error(`could not fetch @${a} ${r}`);I=s.result,b.push(...I.users);for(const e of I.users)Ie.save(e.avatarUrl);if(b.length>c&&(b=b.slice(0,c)),o&&A().transaction((e=>{const t=Math.min(o.followersCount,v().analytics.maxFollowersCount),s=Math.min(o.followingsCount,v().analytics.maxFollowingsCount),n=(i+b.length)/(t+s)*100;e.analytics.scanProgress=Math.max(0,Math.min(n,100))})),0===l.length)continue;if(m=!0,I.users.forEach((e=>{y.add(e.userId),g.has(e.userId)||(S.push({...e,on:n}),m=!1)})),m)for(;w<l.length&&w<b.length-S.length;){const e=l[w];y.has(e.userId)||T.push({...e,on:n}),w++}const u=S.length-T.length===p;if(m&&u)break}while(I.hasNextPage&&b.length<c);if(!I.hasNextPage)for(;w<l.length;){const e=l[w];y.has(e.userId)||T.push({...e,on:n}),w++}return{peerList:b,peerIds:y,nPeers:S,uPeers:T}},i=await r("followers");if(!i)return;const l=i.peerList,u=i.peerIds;let c=i.nPeers,d=i.uPeers;const f=await r("followings",l.length);if(!f)return;const g=f.peerList,p=f.peerIds;let m,w,b=f.nPeers,y=f.uPeers;if(0===s.followers.length&&0===s.followings.length)m=l.map((e=>({...e,on:n}))),w=g.map((e=>({...e,on:n}))),await J().default.setAnalytics({followers:m,followings:w});else{d=d.filter((e=>!u.has(e.userId))),y=y.filter((e=>!p.has(e.userId)));const e=new Set(c.map((e=>e.userId))),t=new Set(d.map((e=>e.userId))),a=new Set(b.map((e=>e.userId))),o=new Set(y.map((e=>e.userId)));m=[...l.map((e=>({...e,on:n}))),...s.followers.filter((e=>!u.has(e.userId)&&!t.has(e.userId)))],w=[...g.map((e=>({...e,on:n}))),...s.followings.filter((e=>!p.has(e.userId)&&!o.has(e.userId)))],c=[...c,...s.nFollowers.filter((t=>!e.has(t.userId)))],s.nFollowers.forEach((t=>e.add(t.userId))),b=[...b,...s.nFollowings.filter((e=>!a.has(e.userId)))],s.nFollowings.forEach((e=>a.add(e.userId))),d=[...d,...s.uFollowers.filter((e=>!t.has(e.userId)))].filter((t=>{const s=t.userId;if(!e.has(s))return!0;return c.find((e=>e.userId===s)).on<t.on})),y=[...y,...s.uFollowings.filter((e=>!o.has(e.userId)))].filter((e=>{const t=e.userId;if(!a.has(t))return!0;return b.find((e=>e.userId===t)).on<e.on})),await J().default.setAnalytics({followers:m,followings:w,nFollowers:c,uFollowers:d,nFollowings:b,uFollowings:y})}log(`analytics job ${t} finished, result:`),log(`  total followers detected: ${m.length}`),log(`  total followings detected: ${w.length}`),log(`  total new-followers: ${c.length}`),log(`  total un-followers: ${d.length}`),log(`  total new-followings: ${b.length}`),log(`  total un-followings: ${y.length}`),A().transaction((e=>{const t=Date.now();e.analytics.firstScanOn=e.analytics.firstScanOn||t,e.analytics.lastScanOn=t,e.analytics.runningJobId=null,e.analytics.error=null,e.igTask.followStatus={}}))}function Pt(){return A().model.state.analytics.runningJobId}async function At(){await d().default(chrome.alarms.clear,"analytics.schedule")}w(),h(),m(),A(),P(),O(),v(),k(),y(),z(),G(),W();var Ct={getTaskKey:function(e){return`insights.task-results-${e}`},extractTaskIdFromKey:function(e){const t=e.match(/^insights\.task-results-([^.]*)$/);return t&&t[1]||null}};A(),h(),D(),O(),v(),k(),C(),G(),h(),v(),k(),m();var Ut=4,xt=function(e){return 0===e?3*m().SECOND:10*m().SECOND},Ot={canRun:function(e){const t=Ft(e);if(t.lastPage&&!t.lastPage.hasNextPage)return!1;if(t.postsCount>=t.maxPostsCount)return!1;return!0},step:async function e(t,s=0){const n=Ft(t);let a;try{a=await async function(e){const t=Ft(e),s=Date.now();let n;if(t.lastPage){const e=new(k().IgPostsPage)(t.lastPage);n=await t.fetchNextPage(e)}else n=await t.fetchRootPage(t.username);if(n.error)throw n.error;return e.responseTimePosts=Date.now()-s,n.result}(t)}catch(n){if(s<Ut-1)return await h().default(xt(s)),void await e(t,s+1);throw n}for(const e of a.posts){const t=e.img||e.imgx;Ie.save(t)}n.results.lastPage=a,n.results.list.push(...a.posts),n.results.list.splice(n.maxPostsCount)}};function Ft(e){return{username:e.task.user.username,results:e.results.basePosts,lastPage:e.results.basePosts.lastPage,postsCount:e.results.basePosts.list.length,maxPostsCount:v().insights.maxPostsCount,fetchNextPage:k().igApi.fetchNextUserPostsPage,fetchRootPage:k().igApi.fetchRootUserPostsPage}}h(),k();var Dt={canRun:function(e,t){const s=Rt(e,t);if(s.lastPage&&!s.lastPage.hasNextPage)return!1;if(s.usersCount===s.maxUsersCount)return!1;return!0},step:async function e(t,s,n=0){const a=Rt(t,s);let o;try{o=await async function(e,t){const s=Rt(e,t),n=Date.now();let a;if(s.lastPage){const e=new(k().IgUsersPage)(s.lastPage);a=await s.fetchNextPage(e)}else a=await s.fetchRootPage(s.username);if(a.error)throw a.error;return e.responseTimePeers=Date.now()-n,a.result}(t,s)}catch(a){if(n<Ut-1)return await h().default(xt(n)),void await e(t,s,n+1);throw a}const r=o.users.map((e=>e.avatarUrl));for(const e of r)Ie.save(e);a.results.lastPage=o,a.results.list.push(...o.users),a.results.list.splice(a.maxUsersCount)}};function Rt(e,t){return{followers:{results:e.results.baseFollowers,lastPage:e.results.baseFollowers.lastPage,username:e.task.user.username,usersCount:e.results.baseFollowers.list.length,maxUsersCount:e.task.followersCount,fetchNextPage:k().igApi.fetchNextFollowersPage,fetchRootPage:k().igApi.fetchRootFollowersPage},followings:{results:e.results.baseFollowings,lastPage:e.results.baseFollowings.lastPage,username:e.task.user.username,usersCount:e.results.baseFollowings.list.length,maxUsersCount:e.task.followingsCount,fetchNextPage:k().igApi.fetchNextFollowingsPage,fetchRootPage:k().igApi.fetchRootFollowingsPage}}[t]}var _t={canRun:e=>Dt.canRun(e,"followers"),step:e=>Dt.step(e,"followers")},Et={canRun:e=>Dt.canRun(e,"followings"),step:e=>Dt.step(e,"followings")};R(),h(),A(),v(),k(),z(),P(),G();var Nt={canRun:function(e,t){return qt(e,t,!0).length>0},step:async function e(t,s,n=0){const a=Ht(t,s),o=qt(t,s),r=await Bt({ctx:t,data:a,type:s,index:o[0]});if(r.error){if(r.error.code!==k().ec.redirectToLogin){if(n<Ut-1)return await h().default(xt(n)),void await e(t,s,n+1);throw r.error}G().default.banSpamAnalysis.dispatch()}r.user&&a.results.list.push(r.user);if(1===o.length||"ok"!==A().model.state.insights.spamcheck.type){const e=a.results.list.map((e=>z().botOrNot.getCredibility(e,t.userId,{forcePrivate:!0}))).filter((e=>e<v().insights.spamCredibility)).length,s=a.results.list.length;a.results.percent=Math.round(e/s*100)/100}}};async function Bt({ctx:e,data:t,type:s,index:n,tries:a=0}){const o=Bt;o.initialized||(o.initialized=!0,o.incognito=!0),t.results.usedIndexes.push(n);const r=Date.now(),i=t.baseUsers[n].username,l=await k().igApi.fetchUserDetails(i,{incognito:o.incognito});if(l.error&&o.incognito){o.incognito=!1;const r=`insights.${R().generate()}`;return chrome.alarms.create(r,{delayInMinutes:1440}),chrome.alarms.onAlarm.addListener((e=>{e.name===r&&(o.incognito=!0)})),P().fetcher.ignoreCache(),Bt({ctx:e,data:t,type:s,index:n,tries:a})}const u=l.result||null;if(G().default.incrementSpamRequestsCount.dispatch(1),e.responseTimeUser=Date.now()-r,u)return{user:u};if(l.error&&a>5||l.error.code===k().ec.redirectToLogin)return{error:l.error};if(l.error&&a>=1){const o=function(e,t,s){if(-1===t)return-1;const n=Ht(e,s),a=n.results.indexes,o=n.results.usedIndexes;let r=t;for(;;){if(r+=1,r===n.baseTotal&&(r=0),r===t){r=-1;break}if(!a.includes(r)&&!o.includes(r))break}return r}(e,n,s);return-1===o?{user:null}:Bt({ctx:e,data:t,type:s,index:o,tries:a+1})}return Bt({ctx:e,data:t,type:s,index:n,tries:a+1})}function Lt(e,t){const s=Ht(e,t);return 0===s.results.indexes.length&&(s.results.indexes=function(e,t){if(0===e)return[];const s=[],n=t/e,a=Array.from(new Array(t)).map(((e,t)=>t));let o=0;for(const e of a)o>e||(o+=n,s.push(e));return s}(s.spamTotal,s.baseTotal)),s.results.indexes}function qt(e,t,s=!1){const n=Ht(e,t);return Lt(e,t).filter((e=>!n.results.usedIndexes.includes(e))).filter((e=>e<(s?n.baseProcessed:n.baseTotal)))}function Ht(e,t){return{followers:{results:e.results.spamFollowers,baseUsers:e.results.baseFollowers.list,baseProcessed:e.results.baseFollowers.list.length,baseTotal:e.task.followersCount,spamProcessed:e.results.spamFollowers.list.length,spamTotal:e.task.spamFollowersCount},followings:{results:e.results.spamFollowings,baseUsers:e.results.baseFollowings.list,baseProcessed:e.results.baseFollowings.list.length,baseTotal:e.task.followingsCount,spamProcessed:e.results.spamFollowings.list.length,spamTotal:e.task.spamFollowingsCount}}[t]}var Mt={canRun:e=>Nt.canRun(e,"followers"),step:e=>Nt.step(e,"followers")},$t={canRun:e=>Nt.canRun(e,"followings"),step:e=>Nt.step(e,"followings")},jt={init:function(){const e=A().model.state.insights;Object.assign(Jt,{netStats:{...e.netStats}}),A().model.observe((e=>{const t=JSON.stringify(e.insights.spamcheck);return`${e.insights.tasks.map((e=>[e.id,e.peerScrapeStatus,e.spamFollowersStatus,e.spamFollowingsStatus].join(":"))).join("-")}_${t}`}),zt)}};const Vt={},Jt={};async function zt(){Gt(),Wt()}async function Gt(){const e=Gt,t=A().model.state.insights.tasks.find((e=>"running"===e.peerScrapeStatus));if(!t){const t=A().model.state.insights.tasks.find((e=>"pending"===e.peerScrapeStatus));if(!t)return;if(e.isPendingInProgress)return;return e.isPendingInProgress=!0,await async function(e){const t=Ct.getTaskKey(e);await O().idbController.delete(t),delete Vt[e]}(t.id),G().default.startPendingTask(t.id),function(e=0){C().stateProxy.hasProPaid()&&D().gaController.sendEvent("user","pro-paid-usage:insights");A().transaction((t=>{t.billing.trial.insights+=e}))}(1),void(e.isPendingInProgress=!1)}const s=await Kt(t.id);if(e.isInProgress)return;e.isInProgress=!0;const n=[Ot,_t,Et],a=n.find((e=>e.canRun(s)));if(!a)return;try{a===Ot?await a.step(s):await bt.addTask((async()=>a.step(s)))}catch(e){console.error(e),G().default.setTaskError.dispatch(t.id,{code:e.code,message:(o=e.code,{[k().ec.noNetwork]:"Could not connect to instagram.com",[k().ec.timedOut]:"Request to instagram.com timed out",[k().ec.suspended]:"Instagram returned error 400, suspended",[k().ec.forbidden]:"Instagram returned error 403, forbidden",[k().ec.notFound]:"Instagram returned error 404, not found",[k().ec.tooManyRequests]:"Instagram returned error 429, too many requests",[k().ec.serverIsDown]:"Instagram returned error 500, server is down",[k().ec.badGateway]:"Instagram returned error 502, bad gateway",[k().ec.serviceUnavailable]:"Instagram returned error 503, service unavailable"}[o]||"Oops, an error occurred")})}var o;Yt(s),await Zt(s),n.find((e=>e.canRun(s)))||G().default.setTaskStatusCompleted.dispatch(t.id),zt();const r=a===Ot?v().sleepTimes.posts:v().sleepTimes.peers;await h().default(r),e.isInProgress=!1,zt()}async function Wt(){if("ok"!==A().model.state.insights.spamcheck.status)return;const e=Wt,t=A().model.state.insights.tasks.find((e=>"running"===e.spamFollowersStatus||"running"===e.spamFollowingsStatus));if(!t){const t=function(){const e=A().model.state.insights.tasks;let t=e.find((e=>"pending"===e.spamFollowersStatus&&("running"===e.peerScrapeStatus||"completed"===e.peerScrapeStatus)));if(t)return{task:t,type:"followers"};if(t=e.find((e=>"pending"===e.spamFollowingsStatus&&e.resultCounters.followingsCount>0)),t)return{task:t,type:"followings"};return{task:null}}();if(!t.task)return;if(e.isPendingInProgress)return;return e.isPendingInProgress=!0,await async function(e,t){const s=await Kt(e.id);"followers"===t?s.results.spamFollowers={list:[],percent:null,indexes:[],usedIndexes:[]}:"followings"===t&&(s.results.spamFollowings={list:[],percent:null,indexes:[],usedIndexes:[]});await Zt(s)}(t.task,t.type),G().default.startSpamPendingTask.dispatch(t.task.id),void(e.isPendingInProgress=!1)}let s;"running"===t.spamFollowersStatus?s="followers":"running"===t.spamFollowingsStatus&&(s="followings");const n=await Kt(t.id);Xt(s,n);const a={followers:Mt,followings:$t}[s];if(a.canRun(n)&&!e.isInProgress){e.isInProgress=!0;try{await a.step(n)}catch(e){G().default.setTaskSpamStatusPlanned.dispatch(n.task.id,s)}Yt(n),await Zt(n),Xt(s,n),await h().default(v().sleepTimes.user),e.isInProgress=!1,zt()}}async function Kt(e){if(!Vt[e]){const t=Ct.getTaskKey(e);let s=await O().idbController.get(t);s||(s={basePosts:{list:[],lastPage:null},baseFollowers:{list:[],lastPage:null},baseFollowings:{list:[],lastPage:null},spamFollowers:{list:[],percent:null,indexes:[],usedIndexes:[]},spamFollowings:{list:[],percent:null,indexes:[],usedIndexes:[]}}),Vt[e]={userId:A().model.state.authStatus.userId,shared:Jt,task:A().model.state.insights.tasks.find((t=>t.id===e)),responseTimePosts:null,responseTimePeers:null,responseTimeUser:null,results:s}}return Vt[e]}function Yt(e){const t=e.shared.netStats;e.responseTimePosts&&(t.avgResponseTimePosts?t.avgResponseTimePosts=(t.avgResponseTimePosts+e.responseTimePosts)/2:t.avgResponseTimePosts=e.responseTimePosts),e.responseTimePeers&&(t.avgResponseTimePeers?t.avgResponseTimePeers=(t.avgResponseTimePeers+e.responseTimePeers)/2:t.avgResponseTimePeers=e.responseTimePeers),e.responseTimeUser&&(t.avgResponseTimeUser?t.avgResponseTimeUser=(t.avgResponseTimeUser+e.responseTimeUser)/2:t.avgResponseTimeUser=e.responseTimeUser),G().default.setNetStats.dispatch(t)}async function Zt(e){const t=Ct.getTaskKey(e.task.id);await O().idbController.set(t,e.results),G().default.updateTaskResultCounters.dispatch(e.task.id,{postsCount:e.results.basePosts.list.length,followersCount:e.results.baseFollowers.list.length,followingsCount:e.results.baseFollowings.list.length,spamFollowersCount:e.results.spamFollowers.list.length,spamFollowingsCount:e.results.spamFollowings.list.length,spamFollowersPercent:e.results.spamFollowers.percent,spamFollowingsPercent:e.results.spamFollowings.percent})}function Xt(e,t){"ok"===A().model.state.insights.spamcheck.status&&("followers"!==e||_t.canRun(t)||Mt.canRun(t))&&("followings"!==e||_t.canRun(t)||Et.canRun(t)||$t.canRun(t))||G().default.setTaskSpamStatusCompleted.dispatch(t.task.id,e)}var Qt={init:async function(){A().model.state.insights.tasks.forEach((e=>{"number"!=typeof e.resultCounters.userCredibility&&G().default.updateCredibility.dispatch(e.id)})),y().chromeBus.on("insights.get-task-results.users",es),y().chromeBus.on("insights.get-task-results.posts",ts),y().chromeBus.on("insights.get-credibility-grade",ss),jt.init(),function(){let e;A().model.observe((e=>e.insights.spamcheck),(t=>{e&&(clearTimeout(e),e=null),"ok"!==t.status&&(e=setTimeout((()=>{G().default.enableSpamAnalysis.dispatch()}),t.disabledTill-Date.now()))}))}(),ns(),async function(){if(w().env.is.development)return;const e=A().model.observe((e=>e.authStatus.userId),(async t=>{if(!t)return;setTimeout((()=>e()));const s=Date.now();P().fetcher.ignoreCache(),await k().igApi.fetchUserDetails("instagram",{incognito:!0});const n=Date.now();G().default.setNetStats.dispatch({avgResponseTimeUser:n-s,avgResponseTimePosts:n-s}),P().fetcher.ignoreCache();const a=await k().igApi.fetchRootFollowersPage("instagram");if(a.error)return;const o=a.result;await h().default(2*m().SECOND);const r=Date.now();P().fetcher.ignoreCache(),await k().igApi.fetchNextFollowersPage(o);const i=Date.now();G().default.setNetStats.dispatch({avgResponseTimePeers:i-r})}))}(),async function(){for(const e of A().model.state.insights.tasks){if(!e.user||"number"==typeof e.user.postsCount)continue;const t=e.user.username,s=(await k().igApi.fetchUserDetails(t)).result;s&&(G().default.setUser.dispatch(e.id,s),await h().default(2e3))}}(),function(){const e=36e5,t=v().insights.spamMaxRequests/v().insights.spamLockDuration*e;setInterval((()=>{G().default.incrementSpamRequestsCount.dispatch(-t)}),e)}()}};async function es(e){const t=Ct.getTaskKey(e),s=await O().idbController.get(t);return{followers:s?s.baseFollowers.list:[],followings:s?s.baseFollowings.list:[]}}async function ts(e){const t=Ct.getTaskKey(e),s=await O().idbController.get(t);return{posts:s?s.basePosts.list:[]}}function ss(e){const t=k().igApi.createUserObject(e),s=A().model.state.authStatus.userId,n=z().botOrNot.getCredibility(t,s);return W().default(n)}async function ns(){const e=[];(await O().idbController.getAllKeys()).forEach((t=>{const s=Ct.extractTaskIdFromKey(t);s&&e.push(s)}));const t=A().model.state.insights.tasks.map((e=>e.id));Object.values(A().model.state.userStates).forEach((e=>{const s=e.insights.tasks.map((e=>e.id));t.push(...s)}));e.filter((e=>!t.includes(e))).forEach((e=>{const t=Ct.getTaskKey(e);O().idbController.delete(t)})),setTimeout(ns,6e4)}O(),z(),K(),D(),P();const as=e=>"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e?JSON.stringify(e):e,os=function(e){console.log(`%c[test] ${as(e)}`,"color: #3d9d30")},rs=function(e){console.log(`%c[test] ${as(e)}`,"color: #e94b35")},is=function(e){console.log(as(e))},ls={init:function(){window.env=w().env,window.ig=v().ig,window.utils=u().utils,window.callAsync=d().default,window.createUrl=f().default,window.createAlarm=g().default,window.AsyncQueue=ae,window.ls=p().default,window.safe=c().default,window.igApi=k().igApi,window.fbApi=fe,window.Response=k().Response,window.IgUsersPage=k().IgUsersPage,window.eventBus=b().eventBus,window.chromeBus=y().chromeBus,window.iframeBus=S().iframeBus,window.botOrNot=z().botOrNot,window.abTestingController=K().abTestingController,window.gaController=D().gaController,window.fetcher=P().fetcher,window.billing=Se,window.idbController=O().idbController,window.sentryController=i().sentryController,window.overseerController=lt,window.analyticsController=yt,window.insightsController=Qt,window.setState=this.setState,window.downgradeVersion=this.downgradeVersion,window.testGetSkuDetails=this.testGetSkuDetails,window.testGetPurchases=this.testGetPurchases,window.testFetchUsername=this.testFetchUsername,window.testFetchUserId=this.testFetchUserId,window.testAll=this.testAll,window.errorsDelta=this.errorsDelta,window.activityDelta=this.activityDelta,window.countMadeActions=this.countMadeActions,(w().env.is.development||w().env.is.beta)&&(window.model=A().model,window.transaction=A().transaction,window.storageController=U().storageController,window.stateProxy=C().stateProxy,window.unbanAllTasks=this.unbanAllTasks,Object.assign(window,m()),this.defineCommit())},countMadeActions:function(e=86400){const t=window.__debug.state,s=u().utils.getUnixTime(),n={likes:0};for(let a=0;a<t.stats.activity.length;a++){const o=t.stats.activity[a];if(s-o.on>e)break;"like"===o.type&&n.likes++}return n},errorsDelta:function(){const e=window.__debug.errors;let t=e[0].on;e.forEach((e=>{log((t-e.on)/60),t=e.on}))},activityDelta:function(){const e=window.__debug.state.stats.activity;let t=e[0].on;window.__debug.state.stats.activity=e.map((e=>{const s=t;return t=e.on,{...e,since:Math.floor((s-e.on)/60)}}))},setState:function(e){const t=a().default.cloneDeep(e);C().replaceState.dispatch(t)},downgradeVersion:function(){const e=a().default.cloneDeep(A().model.state);e.version=e.version-1,C().replaceState.dispatch(e)},unbanAllTasks:function(){const e=a().default.cloneDeep(A().model.state);e.stats.activity=e.stats.activity.filter((e=>"ban"!==e.type)),C().replaceState.dispatch(e)},testGetSkuDetails:function(){return os("billing.getSkuDetails..."),new Promise((e=>{google.payments.inapp.getSkuDetails({parameters:{env:"prod"},success:t=>{os("  success:"),is(t),e()},failure:t=>{w().env.is.development&&t&&t.response&&"INVALID_RESPONSE_ERROR"===t.response.errorType?os("  success:"):rs("  failure:"),is(t),e()}})}))},testGetPurchases:function(){return os("billing.getPurchases..."),new Promise((e=>{google.payments.inapp.getPurchases({parameters:{env:"prod"},success:t=>{os("  success:"),is(t),e()},failure:t=>{rs("  failure:"),is(t),e()}})}))},testFetchUsername:function(){return os("igApi.fetchUsername..."),k().igApi.fetchUsername().then((e=>{os("  success:"),is(e)})).catch((e=>{rs("  failure:"),is(e)}))},testFetchUserId:function(e){return os("igApi.fetchUserId..."),k().igApi.fetchUserId(e).then((e=>(os("  success:"),is(e),e.result))).then((()=>{const e=a().default.cloneDeep(A().model.state);C().replaceState.dispatch(e)})).catch((e=>{rs("  failure:"),is(e)}))},testAll:function(){new Promise((e=>{setTimeout(e,0)})).then(ls.testGetSkuDetails).then(ls.testGetPurchases).then(ls.testFetchUsername).then(ls.testFetchUserId)},defineCommit:function(){Object.defineProperty(window,"commit",{get:()=>(this.setState(A().model.state),null)})}};d();var us={init:async function(){await async function(){for(const e of cs){const t=(await d().default(chrome.cookies.getAll,{url:e})).filter((e=>"unspecified"===e.sameSite));await Promise.all(t.map((async t=>{e.startsWith("http://")?await d().default(chrome.cookies.remove,{url:e,name:t.name}):await d().default(chrome.cookies.set,{url:e,name:t.name,value:t.value,domain:t.domain,path:t.path,secure:!0,httpOnly:t.httpOnly,sameSite:"no_restriction",expirationDate:t.expirationDate,storeId:t.storeId})})))}}(),chrome.webRequest.onHeadersReceived.addListener(ds,{urls:cs},Fe.getVersion()<72?["blocking","responseHeaders"]:["blocking","responseHeaders","extraHeaders"])}};const cs=["http://*.instagram.com/*","https://*.instagram.com/*","https://*.facebook.com/*","http://*.doubleclick.net/*"];function ds(e){return e.responseHeaders.forEach((e=>{"set-cookie"===e.name&&-1!==e.value.indexOf("Secure")&&(-1!==e.value.indexOf("SameSite=Strict")?e.value=e.value.replace(/SameSite=Strict/g,"SameSite=None"):-1!==e.value.indexOf("SameSite=Lax")?e.value=e.value.replace(/SameSite=Lax/g,"SameSite=None"):e.value=e.value.replace(/; Secure/g,"; SameSite=None; Secure"))})),{responseHeaders:e.responseHeaders}}function fs(e){return e&&e.__esModule?e:{default:e}}A(),Y();var gs={},hs={update:function(e){if(!e.userStates)return e;const t={...e,billing:{...e.billing,trial:{...e.billing.trial,dmAdvanced:0}}};return delete t.billing.trial.dmGhost,t}};t(gs,"default",(function(){return hs})),e(gs);var ps={},ms={update:function(e){return{...e,analytics:{...e.analytics,trialLastViewedFollowerId:null,trialLastViewedUnfollowerId:null}}}};t(ps,"default",(function(){return ms})),e(ps);var ws={};O();var vs={update:function(e){return async function(){const e=await O().idbController.getAllKeys();for(const t of e)(t.startsWith("schedule.fcs-post-preview:")||t.startsWith("schedule.local-post:"))&&O().idbController.delete(t)}(),e}};t(ws,"default",(function(){return vs})),e(ws);var bs={},ys={update:function(e){return{...e,schedule:{...e.schedule,localPosts:[]}}}};t(bs,"default",(function(){return ys})),e(bs);var Ss={},ks={update:function(e){return e.userStates?{...e,billing:{...e.billing,trial:{...e.billing.trial,dmAdvanced:Math.max(e.billing.trial.dmAdvanced-50,0)}}}:e}};t(Ss,"default",(function(){return ks})),e(Ss);var Ts={},Is={update:function(e){const t={...e,schedule:{...e.schedule,isSetupPanelShown:!1,setup:{...e.schedule.setup}}};return delete t.schedule.setup.selectedSetupType,t}};t(Ts,"default",(function(){return Is})),e(Ts);var Ps={},As={update:function(e){return e.userStates?{...e,zen:{enabled:!1}}:e}};t(Ps,"default",(function(){return As})),e(Ps);var Cs={},Us={update:function(e){return e.userStates?{...e,billing:{...e.billing,trial:{...e.billing.trial,zen:0}},zen:{...e.zen,lastTrialUpdateOn:null}}:e}};t(Cs,"default",(function(){return Us})),e(Cs);var xs={},Os={update:function(e){return{...e,insights:{...e.insights,lastTaskTimestamps:[]}}}};t(xs,"default",(function(){return Os})),e(xs);var Fs={},Ds={update:function(e){return{...e,billing:{...e.billing,trial:{...e.billing.trial,coverAssist:0}},coverAssist:{shown:!1,loading:!0,videoUrl:null,coverUrl:null,selectedTabId:"auto",showGrid:!1,gridImages:[],frameGalleryImages:[],frameGallerySelectedImage:null,frameSelectImage:null,frameSelectValue:null,frameUploadImage:null}}}};t(Fs,"default",(function(){return Ds})),e(Fs);var Rs={},_s={update:function(e){return e.userStates?{...e,whatsNew:e.whatsNew.filter((e=>"youtube-giveaway"!==e.id))}:e}};t(Rs,"default",(function(){return _s})),e(Rs);var Es={},Ns={update:function(e){if(!e.userStates)return e;const t={...e.billing.fspring},s={};return t.begin&&(s["inssist-pro-monthly"]={active:t.active,state:t.state,begin:t.begin,next:t.next}),delete t.active,delete t.state,delete t.begin,delete t.next,delete t.sku,{...e,billing:{...e.billing,fspring:t,subscriptions:s,products:{}}}}};t(Es,"default",(function(){return Ns})),e(Es);var Bs={},Ls={update:function(e){return e.userStates?{...e,billing:{...e.billing,trial:{...e.billing.trial,addLinkToStory:0}}}:e}};t(Bs,"default",(function(){return Ls})),e(Bs);var qs={},Hs={update:function(e){const t={...e,authStatus:{...e.authStatus,cookies:{ig:{sessionId:e.authStatus.sessionIdCookie},fb:[]}},schedule:{...e.schedule,fcsSetup:{checking:!1,connected:!1,connecting:!1,showPanel:!1,showInstructions:!1,showError:!1}}};return delete t.authStatus.sessionIdCookie,delete t.schedule.setup,delete t.schedule.isVerificationRequired,delete t.schedule.isSetupPanelShown,t}};t(qs,"default",(function(){return Hs})),e(qs);var Ms={},$s={update:function(e){const t={...e,authStatus:{...e.authStatus,cookies:{...e.authStatus.cookies}}};return delete t.authStatus.cookies.ig,t}};t(Ms,"default",(function(){return $s})),e(Ms);var js={},Vs={update:function(e){return e.userStates?{...e,billing:{...e.billing,trial:{...e.billing.trial,repost:0}}}:e}};t(js,"default",(function(){return Vs})),e(js);var Js={},zs={update:function(e){return e.userStates?{...e,whatsNew:e.whatsNew.map((e=>{let t;return t="Share Post to Story"===e.header?"v10.0.1":e.subheader,{id:t,acknowledged:e.acknowledged}}))}:e}};t(Js,"default",(function(){return zs})),e(Js);var Gs={};Z();var Ws={update:function(e){if(!e.userStates)return e;return e.whatsNew.find((e=>"Reposting"===e.id))?{...e,whatsNew:Z().default().map((e=>({id:e.id,acknowledged:!0})))}:e}};t(Gs,"default",(function(){return Ws})),e(Gs);var Ks={},Ys={update:function(e){return{...e,schedule:{...e.schedule,recentScheduledOn:null}}}};t(Ks,"default",(function(){return Ys})),e(Ks);var Zs={},Xs={update:function(e){return{...e,schedule:{...e.schedule,fcsSetup:{checking:!1,connected:!1,connecting:!1,showPanel:!1,errorCode:null}}}}};t(Zs,"default",(function(){return Xs})),e(Zs);var Qs={},en={update:function(e){if(!e.userStates)return e;const t={...e,billing:{...e.billing,trial:{...e.billing.trial}}};return delete t.billing.trial.multiaccount,t}};t(Qs,"default",(function(){return en})),e(Qs);var tn={},sn={update:function(e){return e.authStatus.cookies?e:{...e,authStatus:{...e.authStatus,cookies:{igSessionId:null,fb:[]}}}}};t(tn,"default",(function(){return sn})),e(tn);var nn={},an={update:function(e){return{...e,analytics:{...e.analytics,filters:{query:"",accounts:"all"}},insights:{...e.insights,filters:{query:"",accounts:"all",posts:"all"},tasks:e.insights.tasks.map((e=>{const t={...e};return delete t.followersTableSkip,delete t.followingsTableSkip,t}))}}}};t(nn,"default",(function(){return an})),e(nn);var on={},rn={update:function(e){return{...e,analytics:{...e.analytics,loading:!1},insights:{...e.insights,loading:!1}}}};t(on,"default",(function(){return rn})),e(on);var ln={},un={update:function(e){if(!e.userStates){const t={...e};return delete t.tagAssist,t}return{...e,tagAssist:{shown:!1,collections:[],loadingTags:[],selectedTags:[],loadedTagData:{},errorCode:null,search:{query:"",loading:!1,relevantTags:[]}}}}};t(ln,"default",(function(){return un})),e(ln);var cn={},dn={update:function(e){const t={...e,insights:{...e.insights}};return delete t.insights.isReportOpen,delete t.insights.selectedTaskId,e.userStates&&"tab-insights"===e.sidebar.selectedTabId&&(t.sidebar={...e.sidebar,selectedTabId:"tab-analytics"}),t}};t(cn,"default",(function(){return dn})),e(cn);var fn={},gn={update:function(e){return e.userStates?{...e,whatsNew:e.whatsNew.filter((e=>"earlyadopter-coupon"!==e.id))}:e}};t(fn,"default",(function(){return gn})),e(fn);var hn={},pn={update:function(e){if(!e.userStates)return e;const t={...e,tagAssist:{...e.tagAssist,query:"",searching:!1,foundTags:[]}};return delete t.tagAssist.search,delete t.tagAssist.loadedTagData,t}};t(hn,"default",(function(){return pn})),e(hn);var mn={},wn={update:function(e){return e.userStates?{...e,tagAssist:{...e.tagAssist,latinOnly:!1}}:e}};t(mn,"default",(function(){return wn})),e(mn);var vn={},bn={update:function(e){return e.userStates?{...e,tagAssist:{...e.tagAssist,accountStats:{}}}:e}};t(vn,"default",(function(){return bn})),e(vn);var yn={},Sn={update:function(e){if(!e.userStates)return e;const t={...e,tagAssist:{...e.tagAssist,relevantTags:[]}};return delete t.tagAssist.foundTags,t}};t(yn,"default",(function(){return Sn})),e(yn);var kn={};O();var Tn={update:function(e){return e.userStates&&O().idbController.delete("tag-assist.tag-data"),e}};t(kn,"default",(function(){return Tn})),e(kn);var In={},Pn={update:function(e){return e.userStates?{...e,tagAssist:{...e.tagAssist,ladderConfig:{lastUpdateOn:Date.now(),tiers:{low:.7,medium:1.5,high:5}}}}:e}};t(In,"default",(function(){return Pn})),e(In);var An={},Cn={update:function(e){return e.userStates?{...e,tagAssist:{...e.tagAssist,ladder:null}}:e}};t(An,"default",(function(){return Cn})),e(An);var Un={};O();var xn={update:function(e){return e.userStates&&O().idbController.delete("tag-assist.tag-data"),e}};t(Un,"default",(function(){return xn})),e(Un);var On={},Fn={update:function(e){return e.userStates?{...e,tagAssist:{...e.tagAssist,selectedTabId:"search"}}:e}};t(On,"default",(function(){return Fn})),e(On);var Dn={},Rn={update:function(e){return e.userStates?{...e,tagAssist:{...e.tagAssist,newCollection:{name:"",text:"",showForm:!1},collections:e.tagAssist.collections.map((e=>({...e,editing:!1,editName:"",editText:""})))}}:e}};t(Dn,"default",(function(){return Rn})),e(Dn);var _n={},En={update:function(e){if(!e.userStates)return e;const t={...e,tagAssist:{...e.tagAssist,selectedGroupId:"low",ladderLoadingTags:[],collectionsTagData:{},collectionsLoadingTags:[]}};return delete t.tagAssist.relevantTags,delete t.tagAssist.loadingTags,t}};t(_n,"default",(function(){return En})),e(_n);var Nn={},Bn={update:function(e){return e.userStates?{...e,tagAssist:{...e.tagAssist,engagementSort:null}}:e}};t(Nn,"default",(function(){return Bn})),e(Nn);var Ln={},qn={update:function(e){return e.userStates?{...e,tagAssist:{...e.tagAssist,lastDayUsedOn:null},billing:{...e.billing,trial:{...e.billing.trial,tagAssist:0}}}:e}};t(Ln,"default",(function(){return qn})),e(Ln);var Hn={},Mn={update:function(e){if(!e.userStates)return e;const t=e.billing.trial;return{...e,billing:{...e.billing,trial:{...t,installedOn:t.installedOn||Date.now(),dmAdvanced:t.dmAdvanced||0,schedule:t.schedule||0,insights:t.insights||0,analytics:t.analytics||0,zen:t.zen||0,coverAssist:t.coverAssist||0,tagAssist:t.tagAssist||0,addLinkToStory:t.addLinkToStory||0,postsPublished:t.postsPublished||0,storiesPublished:t.storiesPublished||0,dmsSent:t.dmsSent||0,repost:t.repost||0}}}}};t(Hn,"default",(function(){return Mn})),e(Hn);var $n={},jn={update:function(e){if(!e.userStates)return e;const t={...e,tagAssist:{...e.tagAssist,ladderEngagementSort:e.tagAssist.engagementSort,summaryEngagementSort:null}};return delete t.tagAssist.engagementSort,t}};t($n,"default",(function(){return jn})),e($n);var Vn={},Jn={update:function(e){return e.userStates?{...e,tagAssist:{...e.tagAssist,preselectedTags:[],preselectedText:""}}:e}};t(Vn,"default",(function(){return Jn})),e(Vn);var zn={},Gn={update:function(e){return{...e,reels:{supported:!1}}}};t(zn,"default",(function(){return Gn})),e(zn);var Wn={},Kn={update:function(e){return e.userStates?{...e,billing:{...e.billing,trial:{...e.billing.trial,reels:0}}}:e}};t(Wn,"default",(function(){return Kn})),e(Wn);var Yn={},Zn={update:function(e){return{...e,reels:{...e.reels,creating:!1}}}};t(Yn,"default",(function(){return Zn})),e(Yn);var Xn={},Qn={update:function(e){return{...e,authStatus:{...e.authStatus,isMobileSession:!1}}}};t(Xn,"default",(function(){return Qn})),e(Xn);var ea={},ta={update:function(e){return e.userStates?{...e,billing:{...e.billing,recentFeature:null}}:e}};t(ea,"default",(function(){return ta})),e(ea);var sa={},na={update:function(e){const t={...e,schedule:{...e.schedule,loading:!1}};return delete t.schedule.isRefreshingGrid,t}};t(sa,"default",(function(){return na})),e(sa);var aa={},oa={update:function(e){const t={...e,schedule:{...e.schedule,navigation:{...e.schedule.navigation}}};return delete t.schedule.navigation.fcsTitle,t}};t(aa,"default",(function(){return oa})),e(aa);var ra={},ia={update:function(e){return{...e,schedule:{...e.schedule,filters:{...e.schedule.filters,mediaTypes:e.schedule.filters.mediaTypes.filter((e=>"igtv"!==e))}}}}};t(ra,"default",(function(){return ia})),e(ra);var la={},ua={update:function(e){const t={...e,schedule:{...e.schedule,posts:[...e.schedule.localPosts.map((e=>({id:e.id,source:"local",type:e.type,status:"draft",image:e.image,preview:null,imageAvgColor:e.imageAverageColor,on:e.on,createdOn:Date.now(),stats:null,crosspostToFb:null,draftOrder:e.draftOrder}))),...e.schedule.fcsPosts.map((e=>({id:e.id,source:"fcs",type:e.type,status:e.status,image:e.image,preview:e.preview,imageAvgColor:e.imageAverageColor,on:e.on,stats:e.stats?{...e.stats}:null,crosspostToFb:e.crosspostToFb,draftOrder:e.draftOrder})))]}};return delete t.schedule.igPosts,delete t.schedule.fcsPosts,delete t.schedule.localPosts,t}};t(la,"default",(function(){return ua})),e(la);var ca={},da={update:function(e){const t={...e,schedule:{...e.schedule}};if(e.userStates){const s=[e,...Object.values(e.userStates)];t.acknowledged={...e.acknowledged,scheduleDndTip:s.some((e=>e.schedule.isDndTipAcknowledged))?Date.now():-1}}return delete t.schedule.isDndTipAcknowledged,t}};t(ca,"default",(function(){return da})),e(ca);var fa={},ga={update:function(e){return e.userStates?{...e,installedEventSent:!0,tagAssist:{...e.tagAssist,tagMetricsUpsellDismissed:!1}}:e}};t(fa,"default",(function(){return ga})),e(fa);var ha={},pa={update:function(e){if(!e.userStates)return e;const t={...e,tagAssist:{...e.tagAssist,igSelectedTags:[...e.tagAssist.selectedTags],fcsSelectedTags:[],sidebarSelectedTags:[...e.tagAssist.preselectedTags],sidebarSelectedTagsAsText:[...e.tagAssist.preselectedText]}};return delete t.tagAssist.selectedTags,delete t.tagAssist.preselectedTags,delete t.tagAssist.preselectedText,t}};t(ha,"default",(function(){return pa})),e(ha);var ma={},wa={update:function(e){return{...e,schedule:{...e.schedule,showTagAssist:!1}}}};t(ma,"default",(function(){return wa})),e(ma);var va={},ba={update:function(e){const t={...e,reels:{...e.reels}};return delete t.reels.supported,t}};t(va,"default",(function(){return ba})),e(va);var ya={},Sa={update:function(e){return chrome.alarms.clearAll(),{...e,analytics:{...e.analytics,scheduleDay:-1,scheduleHour:21}}}};t(ya,"default",(function(){return Sa})),e(ya);var ka={},Ta={update:function(e){let t;if(e.userStats){delete{...e,billing:{...e.billing,trial:{...e.billing.trial}}}.billing.trial.zen}else t={...e,zen:{...e.zen}},delete t.zen.lastTrialUpdateOn;return t}};t(ka,"default",(function(){return Ta})),e(ka);var Ia={},Pa={update:function(e){return e.userStats?{...e,tagAssist:{...e.tagAssist,lastTagScanOn:null}}:e}};t(Ia,"default",(function(){return Pa})),e(Ia);var Aa={},Ca={update:function(e){const t={...e};return t.userStates||delete t.sidebar,t}};t(Aa,"default",(function(){return Ca})),e(Aa);var Ua={},xa={update:function(e){return e.igView?{...e,igView:{...e.igView,fullscreenWidth:460,withBorder:!0}}:e}};t(Ua,"default",(function(){return xa})),e(Ua);var Oa={},Fa={update:function(e){const t={...e,analytics:{...e.analytics,runAutomatically:!0,runningJobId:null,lastScanOn:null,nextScanOn:null,error:null,isReportOpen:!0,selectedCard:"nFollowers"},ff:{isActionBlockShown:!1,followStatus:{}}};return delete t.insights.isActionBlockShown,t}};t(Oa,"default",(function(){return Fa})),e(Oa);var Da={},Ra={update:function(e){const t={...e,igTask:e.ff};return delete t.ff,t}};t(Da,"default",(function(){return Ra})),e(Da);var _a={},Ea={update:function(e){return{...e,igTask:{...e.igTask,likeStatus:{}}}}};t(_a,"default",(function(){return Ea})),e(_a);var Na={},Ba={update:function(e){const t={...e,igTask:{...e.igTask,actionBlockCode:null}};return delete t.igTask.isActionBlockShown,t}};t(Na,"default",(function(){return Ba})),e(Na);var La={},qa={update:function(e){return e.userStates?e:{...e,authStatus:{userId:null,username:null,avatarUrl:null,sessionIdCookie:null,isLoggedIn:!1}}}};t(La,"default",(function(){return qa})),e(La);var Ha={},Ma={update:function(e){return e.userStates?{...e,multiaccount:{userIds:e.authStatus.isLoggedIn?[e.authStatus.userId]:[],addingNewAccount:!1}}:e}};t(Ha,"default",(function(){return Ma})),e(Ha);var $a={},ja={update:function(e){if(!e.userStates)return e;const t=e.multiaccount.userIds;return{...e,multiaccount:{...e.multiaccount,selectedUserId:t.length?t[t.length-1]:null}}}};t($a,"default",(function(){return ja})),e($a);var Va={},Ja={update:function(e){return e.userStates?{...e,igView:{...e.igView,creationCardShown:!1}}:e}};t(Va,"default",(function(){return Ja})),e(Va);var za={},Ga={update:function(e){return e.userStates?{...e,billing:{...e.billing,recordedUsernames:[]}}:e}};t(za,"default",(function(){return Ga})),e(za);var Wa={},Ka={update:function(e){const t={...e,schedule:{...e.schedule,setup:{...e.schedule.setup,stepIndex:null,stepTitle:null}}};return delete t.schedule.setup.progress,t}};t(Wa,"default",(function(){return Ka})),e(Wa);var Ya={},Za={update:function(e){return e.userStates?{...e,followUs:{shown:!1,acknowledged:!1}}:e}};t(Ya,"default",(function(){return Za})),e(Ya);var Xa={},Qa={update:function(e){if(!e.userStates)return e;const t={...e,acknowledged:{...e.acknowledged},rateUs:{shown:!1,acknowledged:-1!==e.acknowledged.rateUs}};return delete t.acknowledged.rateUs,t}};t(Xa,"default",(function(){return Qa})),e(Xa);var eo={},to={update:function(e){if(!e.userStates)return e;const t=Date.now(),s={...e,acknowledged:{...e.acknowledged,rateUs:e.rateUs.acknowledged?t:-1,followUs:e.followUs.acknowledged?t:-1},rateUs:{...e.rateUs},followUs:{...e.followUs}};return delete s.rateUs.acknowledged,delete s.followUs.acknowledged,s}};t(eo,"default",(function(){return to})),e(eo);var so={},no={update:function(e){if(!e.userStates)return e;const t={...e,userDetails:{}};return delete t.billing.promostory.followersCount,t}};t(so,"default",(function(){return no})),e(so);var ao={},oo={update:function(e){if(!e.userStates)return e;const t={...e,acknowledged:{...e.acknowledged}};return delete t.acknowledged.postLimitations,t}};t(ao,"default",(function(){return oo})),e(ao);var ro={},io={update:function(e){return e}};t(ro,"default",(function(){return io})),e(ro);var lo={},uo={update:function(e){return{...e,schedule:{...e.schedule,fcsPosts:e.schedule.fcsPosts.map((e=>{const t={...e};return delete t.firstMediaId,t}))}}}};t(lo,"default",(function(){return uo})),e(lo);var co={},fo={update:function(e){return{...e,schedule:{...e.schedule,drafts:[]}}}};t(co,"default",(function(){return fo})),e(co);var go={},ho={update:function(e){const t={...e,dm:{...e.dm,ghostModeEnabled:!1,ghostModeFailed:!1}};return delete t.dm.showBadge,t}};t(go,"default",(function(){return ho})),e(go);var po={},mo={update:function(e){const t={...e,schedule:{...e.schedule,filters:{...e.schedule.filters,statuses:[...e.schedule.filters.statuses,"local"]}}};return delete t.dm.showBadge,t}};t(po,"default",(function(){return mo})),e(po);var wo={};O();var vo={update:function(e){const t={...e,schedule:{...e.schedule,localPosts:e.schedule.drafts}};return delete t.schedule.drafts,async function(){let e;try{e=await O().idbController.getAllKeys()}catch(e){return}for(const t of e){if(!t.startsWith("schedule.drafts:"))continue;const e=t.replace("schedule.drafts:",""),s=await O().idbController.get(t);O().idbController.set(`schedule.local-posts:${e}`,s),O().idbController.delete(t)}}(),t}};t(wo,"default",(function(){return vo})),e(wo);var bo={};O();var yo={update:function(e){return async function(){let e;try{e=await O().idbController.getAllKeys()}catch(e){return}for(const t of e)(t.startsWith("schedule.drafts:")||t.startsWith("schedule.local-posts:"))&&O().idbController.delete(t)}(),{...e,schedule:{...e.schedule,bulkUploadErrors:[]}}}};t(bo,"default",(function(){return yo})),e(bo);var So={},ko={update:function(e){return{...e,schedule:{...e.schedule,localPosts:[]}}}};t(So,"default",(function(){return ko})),e(So);var To={};c(),O();var Io={update:function(e){return async function(){const e=await c().default((()=>O().idbController.getAllKeys()),[]);for(const t of e)t.startsWith("schedule.local-posts:")&&O().idbController.delete(t)}(),{...e,schedule:{...e.schedule,localPosts:[]}}}};t(To,"default",(function(){return Io})),e(To);var Po={},Ao={update:function(e){const t={...e,schedule:{...e.schedule}};return delete t.schedule.csPosts,delete t.schedule.csError,delete t.schedule.csFailed,delete t.schedule.lastCsPostsUpdateOn,delete t.schedule.navigation.csTitle,delete t.schedule.navigation.isCsLoading,delete t.schedule.setup.isCsConnected,t}};t(Po,"default",(function(){return Ao})),e(Po);var Co={},Uo={update:function(e){if(!e.userStates)return e;const t={...e,billing:{...e.billing,trial:{...e.billing.trial,dmGhost:0,schedule:0,insights:0,analytics:0,multiaccount:0}}};return delete t.billing.promostory,t}};t(Co,"default",(function(){return Uo})),e(Co);var xo={},Oo={update:function(e){const t={...e,insights:{...e.insights}};return delete t.insights.availability,t}};t(xo,"default",(function(){return Oo})),e(xo);const Fo={"version-100":fs(gs).default,"version-101":fs(ps).default,"version-102":fs(ws).default,"version-103":fs(bs).default,"version-104":fs(Ss).default,"version-105":fs(Ts).default,"version-106":fs(Ps).default,"version-107":fs(Cs).default,"version-108":fs(xs).default,"version-109":fs(Fs).default,"version-110":fs(Rs).default,"version-111":fs(Es).default,"version-112":fs(Bs).default,"version-113":fs(qs).default,"version-114":fs(Ms).default,"version-115":fs(js).default,"version-116":fs(Js).default,"version-117":fs(Gs).default,"version-118":fs(Ks).default,"version-119":fs(Zs).default,"version-120":fs(Qs).default,"version-121":fs(tn).default,"version-122":fs(nn).default,"version-123":fs(on).default,"version-124":fs(ln).default,"version-125":fs(cn).default,"version-126":fs(fn).default,"version-127":fs(hn).default,"version-128":fs(mn).default,"version-129":fs(vn).default,"version-130":fs(yn).default,"version-131":fs(kn).default,"version-132":fs(In).default,"version-133":fs(An).default,"version-134":fs(Un).default,"version-135":fs(On).default,"version-136":fs(Dn).default,"version-137":fs(_n).default,"version-138":fs(Nn).default,"version-139":fs(Ln).default,"version-140":fs(Hn).default,"version-141":fs($n).default,"version-142":fs(Vn).default,"version-143":fs(zn).default,"version-144":fs(Wn).default,"version-145":fs(Yn).default,"version-146":fs(Xn).default,"version-147":fs(ea).default,"version-148":fs(sa).default,"version-149":fs(aa).default,"version-150":fs(ra).default,"version-151":fs(la).default,"version-152":fs(ca).default,"version-153":fs(fa).default,"version-154":fs(ha).default,"version-155":fs(ma).default,"version-156":fs(va).default,"version-157":fs(ya).default,"version-158":fs(ka).default,"version-159":fs(Ia).default,"version-71":fs(Aa).default,"version-72":fs(Ua).default,"version-73":fs(Oa).default,"version-74":fs(Da).default,"version-75":fs(_a).default,"version-76":fs(Na).default,"version-77":fs(La).default,"version-78":fs(Ha).default,"version-79":fs($a).default,"version-80":fs(Va).default,"version-81":fs(za).default,"version-82":fs(Wa).default,"version-83":fs(Ya).default,"version-84":fs(Xa).default,"version-85":fs(eo).default,"version-86":fs(so).default,"version-87":fs(ao).default,"version-88":fs(ro).default,"version-89":fs(lo).default,"version-90":fs(co).default,"version-91":fs(go).default,"version-92":fs(po).default,"version-93":fs(wo).default,"version-94":fs(bo).default,"version-95":fs(So).default,"version-96":fs(To).default,"version-97":fs(Po).default,"version-98":fs(Co).default,"version-99":fs(xo).default},Do={versioners:{},init:function(){const e=/version-(\d+)/i;Object.keys(Fo).map((t=>{const s=parseInt(t.match(e)[1]);return{key:t,version:s}})).sort(((e,t)=>e.version-t.version)).forEach((e=>{this.versioners[e.version]=Fo[e.key]}))},update:function(e){let t=e,s=t.version||0;log(`versioner: model version is ${s}`);const n=Y().default().version;for(;s<n;){log(`versioner: applying versioner ${s+1}`);const e=this.versioners[s+1];t=e.update(t),t.version=s+1;const n=t.backups||t.userStates;for(const t in n){const a=n[t];try{n[t]=e.update(a),n[t].version=s+1}catch(e){delete n[t]}}s++}return t}};Do.init(),Z();const Ro=function(e){const t=Array.isArray(e.whatsNew)?e.whatsNew:[],s=Z().default();let n=!1;const a=s.map((e=>{let s;if(n)s=!0;else{const a=t.find((t=>t.id===e.id));s=a&&a.acknowledged||!1,s&&(n=!0)}return{id:e.id,acknowledged:s}}));return{...e,whatsNew:a}};A(),Y(),X();var _o=A().action("state.setup-default-state",(e=>e.whatsNew?e:{...Y().default(),...X().default()}));Q();const Eo={init:function(){_o.dispatch(),this._update()},_update:function(){let e=A().model.state;e=Do.update(e),e=Ro(e),e!==A().model.state&&Q().default.dispatch(e)}};U(),A();const No={status:null,init:function(){this._subscribeToInflux()},_subscribeToInflux:function(){A().model.observe((e=>e.whatsNew.some((e=>!e.acknowledged))?"updated":"normal"),(e=>{this._updateBadge(e)}))},_updateBadge:function(e){this.status!==e&&chrome.browserAction.setIcon({path:{48:`img/icon-badge-48-${e}.png`}})}};D(),K();var Bo={init:function(){chrome.runtime.setUninstallURL("https://forms.gle/L6nZ8YUTqUspM34s7")}};A();const Lo={init:function(){this._goOnline=this._goOnline.bind(this),this._goOffline=this._goOffline.bind(this),this._recoverIfOffline=this._recoverIfOffline.bind(this),window.addEventListener("online",this._goOnline,!1),window.addEventListener("offline",this._goOffline,!1),setInterval(this._recoverIfOffline,3e5)},_goOnline:function(){log("starter: going online"),null===A().model.state.authStatus.userId&&je.updateUser()},_goOffline:function(){log("starter: going offline"),null!==A().model.state.authStatus.userId&&je.updateUser()},_recoverIfOffline:function(){null===A().model.state.authStatus.userId&&(log("starter: trying to recover from offline"),je.updateUser())}};d(),A(),y();var qo={init:function(){chrome.cookies.onChanged.addListener((async({cookie:e,cause:t,removed:s})=>{if(!e.domain.includes("instagram.com"))return;if("open-in-inssist"!==e.name)return;if("explicit"!==t)return;if(s)return;const n=await d().default(chrome.windows.getLastFocused),a=await d().default(chrome.tabs.getSelected,n.id);!async function(e){const t=Number(localStorage.getItem("last-tab-id")),s=await d().default(chrome.tabs.get,t),n=e.startsWith("/direct/")&&"/direct/"!==e;n?A().transaction((e=>{e.sidebar.isOpen=!0,e.sidebar.selectedTabId="tab-dm"})):A().transaction((e=>{e.sidebar.isOpen=!1}));s?(chrome.windows.update(s.windowId,{focused:!0}),chrome.tabs.update(s.id,{active:!0}),n||y().chromeBus.send("iframe-bus","ig.ajax-go",e)):(n||localStorage.setItem("instagram-iframe-path",e),chrome.tabs.create({url:"https://app.inssist.com",active:!0}))}(e.value),await d().default(chrome.tabs.remove,a.id),chrome.cookies.remove({url:"https://www.instagram.com",name:"open-in-inssist"})}))}};p(),m(),w(),P(),y(),ee(),te();var Ho={init:function(){y().chromeBus.on("fusion.check-new-version",Vo),y().chromeBus.on("fusion.popup-tab-id",(e=>{Mo=e})),ee().resetController.onReset(jo),chrome.tabs.onRemoved.addListener((e=>{e===Mo&&$o&&Jo()})),y().chromeBus.on("fusion.update-now-click",(()=>{p().default.set("fusion.reload-popup-on-background-start",!0),Jo()})),p().default.get("fusion.reload-popup-on-background-start")&&(p().default.remove("fusion.reload-popup-on-background-start"),y().chromeBus.send("fusion.reload-popup")),chrome.alarms.onAlarm.addListener((async e=>{"fusion.refresh-config"===e.name&&Vo()})),chrome.alarms.create("fusion.refresh-config",{when:Date.now(),periodInMinutes:1440})}};let Mo,$o;function jo(){p().default.remove("fusion.last-check-on")}async function Vo(){const e=15*m().MINUTE,t=Number(p().default.get("fusion.last-check-on"));if(t&&Date.now()<t+e)return;p().default.set("fusion.last-check-on",Date.now());const s=te().default(),n=`${w().env.options.apiUrl}/fusion?version=${s.version}`;P().fetcher.ignoreCache();const a=(await P().fetcher.fetchText(n,{credentials:"omit"})).replace(/&amp;/g,"&").replace(/&#34;/g,'\\"').replace(/&#39/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">"),o=JSON.parse(a);if(!o.config)return;const r=JSON.parse(JSON.stringify(s));$o=zo(r,o.config);chrome.extension.getViews({type:"tab"}).length>0?y().chromeBus.send("fusion.new-version-available"):Jo()}function Jo(){$o&&(p().default.set("fusion.config",$o),location.reload())}function zo(e,t){for(const s in t)oe(e[s])&&oe(t[s])?zo(e[s],t[s]):e[s]=t[s];return e}h(),f(),g(),m(),w(),k(),A(),P(),b(),y(),se();var Go={init:function(){y().chromeBus.on("tag-assist.send-tags-to-redis",Qo),y().chromeBus.on("tag-assist.tag-fetched-from-ig",Zo),async function(){let e;const t=A().model.state.tagAssist.lastTagScanOn;if(t){const s=Date.now()-t;e=Wo.userTagScanPeriod-s,e<0&&(e=0)}else e=0;g().default("tag-assist.periodic-tag-data-collection",{delay:e,period:Wo.userTagScanPeriod},(()=>{!async function(){if(w().env.is.development)return console.warn("⏳ tag assist: collecting user tags... [dev]"),await h().default(5*m().SECOND),console.warn("✅ tag assist: user tags collected [dev]"),void A().transaction((e=>{e.tagAssist.lastTagScanOn=Date.now()}));let e,t;Object.keys(Ko).forEach((e=>{const t=Ko[e];Date.now()-t<Wo.userTagScanTtl||delete Ko[e]}));e=[A().model.state,...Object.values(A().model.state.userStates)].map((e=>e.authStatus.username)).find((e=>!Ko[e]));if(!e){e=((await k().igApi.fetchExplorePageUsernames()).result||[]).find((e=>!Ko[e]))}if(!e)return;Ko[e]=Date.now();t=(await k().igApi.fetchUserRecentTags(e)).result||[],t=t.slice(0,Wo.userTagScanCount);for(const e of t){const t=await k().igApi.fetchTag(e);t.error||(Zo(t.result),await h().default((5+5*Math.random())*m().SECOND))}A().transaction((e=>{e.tagAssist.lastTagScanOn=Date.now()}))}()}))}(),function(){let e;b().eventBus.on("tag-assist.collected-tags-update",(()=>{clearTimeout(e),e=setTimeout(Xo,Wo.sendCollectedTagsTimeout)}))}()}};const Wo=w().env.options.tagAssist,Ko={};let Yo={};function Zo(e){Yo[e.name]={lastScanOn:Date.now(),...e},b().eventBus.send("tag-assist.collected-tags-update")}async function Xo(){if(w().env.is.development)return console.log("send collected tags",Yo),void(Yo={});const e=Object.values(Yo);Yo={},await Qo(e)}async function Qo(e=[]){const t=A().model.state.authStatus.userId;if(t)try{const s=f().default(Wo.apiUrl,{id:t});await P().fetcher.fetch(s,{method:"POST",credentials:"omit",headers:{"content-type":"application/json"},body:JSON.stringify({tags:e.map(se().compressTag)})})}catch(e){console.error("failed to send tags to the api",e)}}g(),m(),w(),k(),A(),se(),ne();var er={init:function(){A().model.observe((e=>e.authStatus.userId),(()=>{tr()})),g().default("tag-assist.update-account-stats",{period:4*m().HOUR},(()=>{tr()}))}};async function tr(e=0){const t=A().model.state,s=t.authStatus.userId;if(!s)return;const n=Date.now(),a=ne().default.getAccountStats(),o=a&&n-a.lastScanOn;if(o&&o<w().env.options.tagAssist.accountStatsTtl)return;const r=t.authStatus.username,i=await k().igApi.fetchUserPosts(r,42);if(i.error)return e<2?void tr(e+1):void console.error("failed to update account stats");const l=i.result;let u=0,c=0;for(const e of l)u+=k().igApi.normalizePostStat24h(e.stats.likes,e.on),c+=k().igApi.normalizePostStat24h(e.stats.comments,e.on);l.length>0&&(u=Math.round(u/l.length),c=Math.round(c/l.length));const d=se().sortByFrequency(l.map((e=>e.caption||"")).map((e=>se().extractTags(e,!0))));A().transaction((e=>{e.tagAssist.accountStats[s]={avgLikes:u,avgComments:c,mostUsedTags:d.slice(0,3),lastScanOn:Date.now()}}))}var sr={init:function(){Go.init(),er.init()}};!async function(){window._=a().default,o().polyfillsController.init();const e=Fe.getVersion();console.log(`chrome version is: ${e}`),r().logController.init(),await us.init(),i().sentryController.init({dsn:"https://bea0900834f541bca8157710f7fd31fe@sentry.io/1547551"}),l().i18nController.init(),Re.init(),qe.init(),K().abTestingController.init(),Bo.init(),await U().synchController.init("background",!0),Eo.init(),ke.init(),lt.init(),ls.init(),gt.init(),yt.init(),Qt.init(),rt.init(),qo.init(),Ho.init(),Ie.init(),sr.init(),D().gaController.init().sendPageview().sendInstall(),je.init(),await je.updateUser(),Se.init(),await Se.updatePro(),No.init(),Lo.init(),window._backgroundReady=!0}()}();